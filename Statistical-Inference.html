<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Статистический вывод и тестирование исследовательских гипотез</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Statistical-Inference_files/libs/clipboard/clipboard.min.js"></script>
<script src="Statistical-Inference_files/libs/quarto-html/quarto.js"></script>
<script src="Statistical-Inference_files/libs/quarto-html/popper.min.js"></script>
<script src="Statistical-Inference_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Statistical-Inference_files/libs/quarto-html/anchor.min.js"></script>
<link href="Statistical-Inference_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Statistical-Inference_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Statistical-Inference_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Statistical-Inference_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Statistical-Inference_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Statistical-Inference_files/libs/quarto-contrib/iconify-1.0.8/iconify-icon.min.js"></script>
<meta name="mermaid-theme" content="default">
<script src="Statistical-Inference_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="Statistical-Inference_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="Statistical-Inference_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Статистический вывод и тестирование исследовательских гипотез</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="общее-понятие-и-логика-статистического-вывода" class="level2">
<h2 class="anchored" data-anchor-id="общее-понятие-и-логика-статистического-вывода">Общее понятие и логика статистического вывода</h2>
<p>Статистический вывод (<em>statistical inference</em>) представляет собой процесс получения логических выводов о генеральной совокупности и ее свойствах на основании данных выборочного исследования.</p>
<p>На основании выборки исследователь тестирует те или иные гипотезы, часто:</p>
<ul>
<li>о различии статистических совокупностей (представления о распределении семейных обязанностей различаются у мужчин и женщин),</li>
<li>о наличии закономерностей (на основе анализа совокупности явлений) об отсутствии случайностей (например, случайности распределения данных в последовательности)</li>
</ul>
<p>Результатом статистического вывода является статистическое суждение, например:</p>
<ul>
<li>точечная оценка (например, среднее значение, факторная нагрузка)</li>
<li>доверительный интервал (для статистического параметра)</li>
<li>отвержение гипотезы.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Статистический анализ = анализ описательных статистик + статистический вывод</p>
</div>
</div>
<p><strong>Логика статистического вывода</strong> представляет собой порядок действий аналитика при проведении статистического анализа. В целом, она не зависит от конкретной проблемы и используемых статистических методов, однако, на практике, благодаря большому репертуару статистических инструментов, конечно, имеет свои особенности.</p>
<p>Этапы:</p>
<ol type="1">
<li>Формулировка статистических гипотез (нулевых и альтернативных), позволяющих подтвердить существующую теорию или доказать авторскую.</li>
<li>Выбор статистического критерия (метода анализа), позволяющего подтвердить гипотезы и расчет его статистических значений.</li>
<li>Определение статистической значимости (p-value) и доверительных интервалов.</li>
<li>Вывод о сохранении нулевых или подтверждении выдвинутых гипотез.</li>
</ol>
<section id="статистические-гипотезы" class="level3">
<h3 class="anchored" data-anchor-id="статистические-гипотезы">Статистические гипотезы</h3>
<p><strong>Статистическая гипотеза</strong> - предположение о виде распределения и свойствах случайной величины, которое можно подтвердить или опровергнуть применением статистических методов к данным выборки.</p>
<p><strong>Нулевая гипотеза</strong> (<span class="math inline">\(H_0\)</span>, <em>null hypothesis</em>) – содержит предположение об отсутствии различий, влияния фактора, различия значения выборочной характеристики от заданной величины (например, нуля) и т. п. Как правило, Н0 не является для исследователя содержательной гипотезой, т. е. предметом и целью доказательства.</p>
<p><strong>Альтернативная гипотеза</strong> (<span class="math inline">\(H_1\)</span>, <em>alternative hypothesis</em>) – другое проверяемое предположение, конкурирующая гипотеза (о наличии различий, взаимосвязей, отсутствии случайности, отличии от нуля и пр.). Обычно, за исключением некоторых случаев, профессиональный интерес исследователя сводится именно к верификации альтернативной гипотезы.</p>
<p>Нулевая гипотеза сохраняется или отвергается исходя из того, насколько <em>вероятным</em> оказывается наблюдаемый результат.</p>
<p>Для оценки статистических гипотез используются статистические критерии (математические правила), для которых имеются рассчитанные распределения и по которым эти вероятности можно посчитать.</p>
<blockquote class="blockquote">
<p><strong>Примеры</strong>: критерии согласия (Пирсона, Колмогорова-Смирнова), проверки на однородность (например, тест Ливиня), параметрические (t-критерий, коэффициент корреляции Пирсона – содержат в формулах средние и дисперсии) и непараметрические критерии (Манна-Уитни, Уилкоксона, часто имеют ранговый характер).</p>
</blockquote>
<div class="{callout-note}">
<p>С каждым критерием связана некоторая статистика <span class="math inline">\(S\)</span>, которая измеряет отклонение в наблюдаемом процессе от ситуации, соответствующей <span class="math inline">\(H_0\)</span>.</p>
</div>
<p>В силу случайности извлекаемых выборок случайными оказываются и значения статистики <span class="math inline">\(S\)</span>, вычисляемые в соответствии с этими выборками. То есть, если мы много раз будем извлекать выборки из генеральной совокупности, значения статистики будут отличаться, и разница между ними будет носить случайный характер.</p>
 <iframe id="example1" src="https://gallery.shinyapps.io/CLT_mean/" style="border: none; width: 100%; height: 720px" frameborder="0"></iframe>
<p>При справедливости проверяемой гипотезы <span class="math inline">\(H_0\)</span> статистика <span class="math inline">\(S\)</span> подчиняется некоторому распределению <span class="math inline">\(g(𝑆│𝐻_0 )\)</span>, например, нормальному распределению, t-распределению, распределению <span class="math inline">\(\chi^2\)</span> и др.</p>
<p>В этом распределении выделяется <strong>два множества: случайных отклонений и критических значений</strong>. Если статистика попадает в область критических значений – нулевая гипотеза отклоняется, в противном случае – нет.</p>
<div id="fig-inf" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-inf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<img src="images/StatInf/hyp1.png" class="img-fluid figure-img">
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Области критических значений
</figcaption>
</figure>
</div>
</section>
<section id="доверительная-вероятность-и-доверительный-интервал" class="level3">
<h3 class="anchored" data-anchor-id="доверительная-вероятность-и-доверительный-интервал">Доверительная вероятность и доверительный интервал</h3>
<p>Чтобы отклонить нулевую гипотезу, мы выбираем субъективное суждение относительно <strong>уровня риска</strong>, который мы готовы принять для того, чтобы ошибиться. Этот риск оказывается отраженным в понятиях доверительного интервала и доверительной вероятности.</p>
<p><strong>Доверительный интервал</strong> (<em>confidence interval</em>, <span class="math inline">\(CI\)</span>)- диапазон, в котором находятся истинные средние значения в генеральной совокупности с определенной доверительной вероятностью.</p>
<p><strong>Доверительная вероятность</strong> (<em>confidence level</em>, <span class="math inline">\(CL\)</span>) – вероятность того, что доверительный интервал содержит значение оцениваемого параметра.</p>
<p>Типичные значения доверительной вероятности – 90%, 95% (чаще всего), 99%. Чем больше доверительная вероятность, тем шире (и иногда бесполезнее) интервал.</p>
<p><strong>Пример</strong>: с 95% вероятностью можно утверждать, что данного мнения о реализации национального проекта придерживаются 48% до 73% жителей региона.</p>
 <iframe id="example1" src="https://rpsychologist.com/d3/ci/" style="border: none; width: 100%; height: 720px" frameborder="0"></iframe>
</section>
<section id="ошибки-при-оценке-статистических-гипотез" class="level3">
<h3 class="anchored" data-anchor-id="ошибки-при-оценке-статистических-гипотез">Ошибки при оценке статистических гипотез</h3>
<p><strong>Ошибка первого рода</strong> – показывает вероятность того, что мы найдем различия там, где их на самом деле нет! <strong>Нездоровые сенсации, большой вред</strong> (Пример: поставили диагноз, а болезни нет, признали виновным, а вины нет)</p>
<p>Можем контролировать путем подбора порога значений, ниже которого будем считать, что различий нет, то есть уровня значимости.</p>
<p>Типичный порог – <span class="math inline">\(\alpha\)</span> = 0,05</p>
<p><strong>Ошибка второго рода</strong> – различия есть, но мы их не нашли. <strong>Близорукость, слепота критерия, мы ее не можем контролировать!</strong> Вред небольшой.</p>
<p>Минимизировать ошибку второго рода можно путем подбора статистического критерия.</p>
<p>Ошибку первого рода можно совершить, только, если мы отвергли <span class="math inline">\(H_0\)</span>, а ошибку второго рода – если мы приняли <span class="math inline">\(H_0\)</span>. Сразу две ошибки совершить нельзя!</p>
<p>Оптимальная величина α (критический уровень значимости) должна удовлетворять двум противоречивым требованиям:</p>
<ol type="1">
<li><p>она должна быть достаточно мала, чтобы обеспечить высокое доверие к выводу об отклонении <span class="math inline">\(H_0\)</span></p></li>
<li><p>но она должна быть достаточно велика, чтобы реже допускать ошибки 2-го рода</p></li>
</ol>
<p>При этом вероятность ошибки 𝛽 уменьшается при увеличении значения 𝛼, а для фиксированного значения 𝛼:</p>
<ul>
<li>при увеличении объема выборки;</li>
<li>при уменьшении выборочной дисперсии.</li>
</ul>
<div id="fig-error" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-error-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/StatInf/error.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-error-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Ошибки первого и второго рода
</figcaption>
</figure>
</div>
</section>
<section id="односторонние-и-двусторонние-критерии.-определение-уровня-значимости" class="level3">
<h3 class="anchored" data-anchor-id="односторонние-и-двусторонние-критерии.-определение-уровня-значимости">Односторонние и двусторонние критерии. Определение уровня значимости</h3>
<p>В случае <strong>одностороннего критерия (one-tailed, one-sided)</strong> полученное значение статистики <span class="math inline">\(S^*\)</span> сравнивают с критическим значением <span class="math inline">\(𝑆_{(1−\alpha)}\)</span> при заданном уровне значимости <span class="math inline">\(\alpha\)</span> или делают вывод на основе «достигнутого уровня значимости» (p-value): вероятности возможного превышения полученного значения статистики при справедливости <span class="math inline">\(H_0\)</span>.</p>
<p>Односторонний критерий применяется для оценки направленных гипотез, в которых содержатся утверждения «больше (выше)» или «меньше (ниже)».</p>
<p><strong>Пример</strong>: уровень доверия к некоммерческим организациям у женщин выше, чем у мужчин.</p>
<div id="fig-one-sided" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/StatInf/one-sided.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Графическая интерпретация одностороннего статистического критерия
</figcaption>
</figure>
</div>
<p>В случае <strong>двустороннего критерия (two-tailed, two-sided)</strong> критическая область состоит из двух частей. И проверяемая гипотеза <span class="math inline">\(H_0\)</span> отклоняется, если <span class="math inline">\(S^∗&gt;𝑆_{(\alpha/2)}\)</span> или <span class="math inline">\(S^∗&lt;S_{1-\alpha /2}\)</span>.</p>
<p>Двусторонний критерий применяется для оценки ненаправленных гипотез (действуют в обе стороны), в которых содержатся утверждения «отличается» или «не равен».</p>
<p><strong>Пример</strong>: уровень доверия к некоммерческим организациям у женщин у мужчин различается.</p>
<div id="fig-two-sided" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/StatInf/two-sided.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Графическая интерпретация двустороннего статистического критерия
</figcaption>
</figure>
</div>
</section>
<section id="мощность-статистического-критерия" class="level3">
<h3 class="anchored" data-anchor-id="мощность-статистического-критерия">Мощность статистического критерия</h3>
<p>Мощность статистического критерия — это способность критерия обнаружить эффект, в случае если этот эффект действительно существует. С точки зрения статистики, это вероятность справедливого опровержения нулевой гипотезы.</p>
<p>При проверке любой статистической гипотезы желательно использовать наиболее мощный критерий, который для заданной вероятности <span class="math inline">\(𝛼\)</span> ошибки 1-го рода обеспечивает минимальную вероятность <span class="math inline">\(𝛽\)</span> ошибки 2-го рода относительно любой конкурирующей гипотезы <span class="math inline">\(H_1\)</span>.</p>
<p>Желательно всегда, если позволяют данные, применять более мощный критерий, так как это позволяет избежать ошибки 2-го рода.</p>
<div id="fig-power" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/StatInf/power.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Плотности распределения статистик при справедливости соответственно гипотез <span class="math inline">\(H_0\)</span> и <span class="math inline">\(H_1\)</span> в случае двустороннего критерия.
</figcaption>
</figure>
</div>
</section>
<section id="выбор-метода-для-анализа" class="level3">
<h3 class="anchored" data-anchor-id="выбор-метода-для-анализа">Выбор метода для анализа</h3>
<p>Выбор метода, с помощью которого будут анализироваться данные, осуществляется еще на этапе разработки программы научного исследования на основе его цели и задач, определяющих общий дизайн, методологические подходы и основные показатели исследования. Сразу, на «берегу», если исследователь делает выбор в пользу «количественной» аналитический стратегии, решается вопрос относительно объема и принципов формирования выборочной совокупности, необходимой для получения достаточных данных для доказательства исследовательских гипотез, а также обрисовываются контуры инструментария исследования, в который оказываются вплетены не только тщательно операционализированные и эмпирически интерпретированные понятия, но и подразумеваемые уровни измерения соцологических явлений и феноменов, от которых будет зависеть выбор конкретного статистического метода. Так, например, в исследовании перспектив развития гражданского общества в регионах России, может ставиться исследовательский вопрос об участии граждан в деятельности общественных, благотворительных организаций.</p>
<p>От того, в какой форме будет задан вопрос, как будет сформулирована исследовательская задача: от простого установления факта такого участия (что может быть достигнуто вопросом: «Участвуете ли Вы в деятельности какой-либо общественной организации или благотвориктельного общества?“) до количественного измерения вклада в деятельность НКО путем определения временных или трудозатрат («Сколько часов своего личного времени Вы тратите на общественную деятельность?», «Если перевести затраченное время в денежный эквивалент, согласно получаемой Вами зарплате на основном месте работы, сколько Вы тратите на помощь общественной организации?») будет зависеть, к какому уровню измерения (категориальному или уровню отношений) будут отнесены данные, и какой статистический метод может быть использован для проверки гипотез о том, какие слои населения в большей степени принимают участие в деятельности общественных организаций, или какие профессионалы вносят больший вклад, участвуя в программах pro bono.</p>
<p>Чтобы выбрать метод, с помощью которого можно было бы проверить статистические гипотезы, нужно выполнить ряд простых действий:</p>
<ul>
<li>Уточнить тип данных (количественные или качественные)</li>
<li>В случае количественных данных уточнить тип распределения (нормальное или отличное от нормального)</li>
<li>Уточнить количество сравниваемых групп (если они есть)</li>
<li>Уточнить, связаны ли группы сравнения между собой, т. е. являются ли единицы наблюдения в группах разными носителями признака (независимые группы), или это одни респонденты, которых опрашивали несколько раз (связанные группы).</li>
</ul>
<p>Ответы на эти вопросы будут определять выбор статистического метода.</p>
<p>Примерная схема принятия решения для случая, когда планируется сравнивать выраженность количественного признака в одной или нескольких группах, может быть следующей:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A[Сколько групп сравнивается?] --&gt;F[1]
  subgraph Сравнение с заданным значением
  F--&gt;|Параметрические|O[z-критерий \n t-критерий]
  F--&gt;|Непараметрические|P[Критерий \n Уилкоксона]
  end
  A--&gt;D[2]
  A--&gt;J[3+]
  subgraph Зависимые группы
  D--&gt;|Параметрические|T[t-критерий \n для парных \n выборок]
  D--&gt;|Непараметрические|L[Критерий \n Уилкоксона]
  J --&gt;|Параметрические|K[Дисперсионный анализ \n для повторных \n измерений]
  J--&gt;|Непараметрические|M[Критерий \n Фридмана]
  end
  A--&gt;R[2]
  A--&gt;Q[3+]
  subgraph Независимые группы 
  R--&gt;|Параметрические|S[t-критерий для \n независимых выборок]
  R--&gt;|Непараметрические|U[U-критерий \n Манна-Уитни]
  Q--&gt;|Параметрические|W[Однофакторный \n дисперсионный анализ]
  Q--&gt;|Непараметрические|Y[Непараметрический \n дисперсионный анализ\n Краскела-Уоллиса]
  end
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Если в центре анализа находятся качественные данные, то рассуждения аналитика могут выстраиваться таким образом:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  classDef dark color:#fff,fill:#0d5caa
  A[Сколько групп сравнивается]--&gt;B[Одна]
  A--&gt;C[Две]
  A--&gt;D[Три и больше]
  subgraph Сравнение с заданным значением
  B--&gt;E[z-критерий]
  end
  subgraph Зависимые группы
  C--&gt;F[Критерий Мак-Немара]
  D--&gt;G[Q-критерий Кокрена]
  end
  A--&gt;K[Две]
  A--&gt;L[Три и больше]
  subgraph Независимые группы
  K--&gt;I[Хи-квадрат Пирсона]
  L--&gt;J[Хи-квадрат Пирсона с поправкой на правдоподобие]
  end
  class C,K,F,I dark
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Рассмотрим каждый из приведенных критериев подробнее.</p>
</section>
</section>
<section id="сопоставление-количественных-результатов-с-заданным-значением" class="level2">
<h2 class="anchored" data-anchor-id="сопоставление-количественных-результатов-с-заданным-значением">Сопоставление количественных результатов с заданным значением</h2>
<section id="z-критетий-и-t-критерий-стьюдента-для-одной-выборки" class="level3">
<h3 class="anchored" data-anchor-id="z-критетий-и-t-критерий-стьюдента-для-одной-выборки">z-критетий и t-критерий Стьюдента для одной выборки</h3>
<p>В том случае, когда мы имеем какой-либо количественный показатель и хотим сравнить со средним значением в генеральной совокупности, которое известно заранее (из ранее проведенных исследований, регламентов, переписей населения и др. источников), мы можем для этого использовать z и t-критерии.</p>
<p>Оба теста преследуют весьма сходные цели - сравнить выборочные средние значения с гипотетическими значениями, и являются <em>параметрическими</em>, что означает соблюдение требования о непрерывности распределения и нормальности данных.</p>
<p>Их отличия кроются в используемых статистических распределениях (z - критерий использует нормальное распределение, тогда как t-критерий, естественно, t-распределение с более «тяжелыми» хвостами, что делает его более консервативным), а также отношение к стандартному отклонению. Если стандартное отклонение в генеральной совокупности известно, предпочтительнее использовать z-критерий, если его нет - одновыборочный критерий Стьюдента.</p>
<section id="z-критерий" class="level4">
<h4 class="anchored" data-anchor-id="z-критерий">z-критерий</h4>
<p>Для того, чтобы корректно использовать z-критерий для тестирования гипотез, необходимо выполнять следующие требования:</p>
<ul>
<li>показатель, который мы исследуем, в генеральной совокупности должен иметь нормальное распределение (проверить практически нереально, но мы можем сделать проверку выборочного распределения в качестве «прокси»);</li>
<li>наблюдения в выборке должны быть независимыми, а сама выборка - случайной</li>
<li>мы должны знать стандартное отклонение в генеральной совокупности</li>
<li>размер выборки должен быть достаточно большим, по меньшей мере <span class="math inline">\(n &gt; 30\)</span>.</li>
</ul>
<p>Какие гипотезы мы формулируем, когда используем z-критерий?</p>
<p>Что касается нулевой гипотезы, то здесь все просто:</p>
<p><span class="math inline">\(H_0: \bar{x}=\mu_0\)</span> – выборочное среднее равно предполагаемому среднему в генеральной совокупности</p>
<p>А вот альтернативная гипотеза может быть сформулирована тремя возможными способами:</p>
<ul>
<li><span class="math inline">\(H_{a1} : \bar{x}&lt;\mu_0\)</span> – выборочное среднее меньше предполагаемого среднего значения (левостронний тест)</li>
<li><span class="math inline">\(H_{a2} : \bar{x}&gt;\mu_0\)</span> – выборочное среднее больше предполагаемого среднего значения (правосторонний тест)</li>
<li><span class="math inline">\(H_{a3} : \bar{x} \neq \mu_0\)</span> – выборочное среднее отличается от предполагаемого среднего значения (двусторонний тест)</li>
</ul>
<p>Формула для расчета z-критерия: <span class="math display">\[z=\frac{\bar{x}-\mu_0}{\sigma \ \sqrt{n}},\]</span></p>
<p>где: <span class="math inline">\(\bar{x}\)</span> – выборочное среднее <span class="math inline">\(\mu_0\)</span> – гипотетическое среднее, с которым мы сравниваем выборочное среднее <span class="math inline">\(n\)</span> – объем выборки <span class="math inline">\(\sigma\)</span> – гипотетическое стандартное отклонение</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon> <strong>Пример 1</strong>: Предположим, вы хотите оценить уровень удовлетворенности студентов материально-техническим оснащением на вашем университетском кампусе. Ваша гипотеза состоит в том, что средний уровень удовлетворенности составляет 6.5, что было определено в результате прошлогоднего исследования, и хотите проверить, верно ли это. Вы знаете, что стандартное отклонение оценок составляет 1,4.</p>
</blockquote>
<blockquote class="blockquote">
<p>Вы случайным образом отобрали 100 студентов и попросили их оценить свой уровень удовлетворенности по шкале от 1 до 10. После сбора данных, вы рассчитали среднюю оценку уровня удовлетворенности студентов, которая оказалась равной 6,8, со стандартным отклонением 1,2.</p>
</blockquote>
<p>Сгенерируем аналогичные данные с помощью функции <code>rnorm()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">100</span>, <span class="at">mean =</span> <span class="fl">6.8</span>, <span class="at">sd =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Поскольку мы заранее определили, что наши данные происходят из нормального распределения, довольно бессмысленно их проверять на нормальность. В доказательство сделаем гистограмму:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hist-for-z-test" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hist-for-z-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-hist-for-z-test-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hist-for-z-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Проверка данных на нормальность графическим способом
</figcaption>
</figure>
</div>
</div>
</div>
<p>Установим пакет <code>BSDA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"BSDA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Посчитаем статистику теста:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"BSDA"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">z.test</span>(data,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">alternative =</span> <span class="st">"two.sided"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">mu =</span> <span class="fl">6.5</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">sigma.x =</span> <span class="fl">1.4</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">conf.level =</span> <span class="fl">0.95</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One-sample z-Test

data:  data
z = 2.9178, p-value = 0.003526
alternative hypothesis: true mean is not equal to 6.5
95 percent confidence interval:
 6.634092 7.182882
sample estimates:
mean of x 
 6.908487 </code></pre>
</div>
</div>
<p>Результаты теста показывают, что оценка удовлетворенности студентов значимо отличается от гипотетической.</p>
<p>Визуально это можно представить в виде графика, показывающего, насколько далеко полученное z-значение находится от нулевой отметки, символизирующей отсутствие отличий эмпирического и теоретического средних значений. Поскольку мы использовали ненаправленную гипотезу (средние отличаются, но не понятно, как именно) и двусторонний тест, то и вероятности мы будем считать тоже как бы «в обе стороны». По тесту у нас получилось p-значение = 0,003 (вероятность ошибочно отвергнуть нулевую гипотезу составляет 0.3%) и мы разбиваем его на две части - по 0,0015 (около 0,15%) с каждой стороны.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-plotztest" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plotztest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-plotztest-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotztest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Графическая интерпретация z-теста (двусторонний критерий)
</figcaption>
</figure>
</div>
</div>
</div>
<p>Если бы мы ставили гипотезу о том, что получившееся среднее превышает гипотетическую величину (мы предполагали бы, что оценка удовлетворенности выросла), то есть использовали бы <em>направленную</em> гипотезу и, соответственно, односторонний критерий, то результаты были бы следующими:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-plotztest2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plotztest2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-plotztest2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotztest2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Графическая интерпретация z-теста (односторонний критерий)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="одновыборочный-t-критерий" class="level4">
<h4 class="anchored" data-anchor-id="одновыборочный-t-критерий">Одновыборочный t-критерий</h4>
<p>Одновыборочный t-критерий «ведет себя» в целом аналогично z-критерию: он также применяется к данным, подчиняющимся закону нормального распределения.</p>
<p>Нулевая гипотеза:</p>
<ul>
<li><span class="math inline">\(H_0:m=μ\)</span></li>
</ul>
<p>Альтернативные гипотезы:</p>
<ul>
<li><span class="math inline">\(H_a:m≠μ\)</span> (двусторонний критерий)</li>
<li><span class="math inline">\(H_a:m&gt;μ\)</span> (правосторонний)</li>
<li><span class="math inline">\(H_a:m&lt;μ\)</span> (левосторонний)</li>
</ul>
<p>Формула:</p>
<p><span class="math display">\[t = \frac{m-\mu}{s/\sqrt{n}}\]</span></p>
<p>Разберем возможности применения критерия на следующем примере.</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon> <strong>Пример 2</strong>: Минимальный размер оплаты труда в Алтайском крае с 1 января 2024 года составляет 20 454 руб. Вы работаете в научно-исследовательском центре и занимаетесь социально-экономическими исследованиями. В результате опроса населения были получены следующие данные о заработной плате жителей одного из сел. Докажите, что среднее значение в выборочной совокупности отличается от установленного минимального размера заработной платы в регионе.</p>
</blockquote>
<p>Рассмотрим следующие данные:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">18431</span>, <span class="dv">21211</span>, <span class="dv">18200</span>, <span class="dv">17502</span>, <span class="dv">25581</span>, <span class="dv">29684</span>, <span class="dv">30319</span>, <span class="dv">27533</span>, <span class="dv">15328</span>, <span class="dv">30801</span>, <span class="dv">18650</span>, <span class="dv">22702</span>, <span class="dv">17807</span>, <span class="dv">35468</span>, <span class="dv">17693</span>, <span class="dv">17966</span>, <span class="dv">21690</span>, <span class="dv">19580</span>, <span class="dv">24581</span>, <span class="dv">25817</span>, <span class="dv">28493</span>, <span class="dv">33954</span>, <span class="dv">22030</span>, <span class="dv">22300</span>, <span class="dv">16290</span>, <span class="dv">15371</span>, <span class="dv">26745</span>, <span class="dv">20320</span>, <span class="dv">21226</span>, <span class="dv">20522</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вычислим t-критерий, сравнив выборочное среднее с минимальным размером оплаты труда</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>t_test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(data, <span class="at">mu =</span> <span class="dv">20454</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>t_test </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  data
t = 2.3188, df = 29, p-value = 0.02765
alternative hypothesis: true mean is not equal to 20454
95 percent confidence interval:
 20730.00 24856.33
sample estimates:
mean of x 
 22793.17 </code></pre>
</div>
</div>
<p>Результаты анализа указывают на то, что средняя зарплата в данном населенном пункте достоверно отличается от минимального размера оплаты труда в регионе (<span class="math inline">\(t_{29}=2,3188, p=0,028\)</span>). Мы видим, что сравниваемое значение 20454 не попадает в 95% интервал, границы которого определяются значениями 20730,0 и 24856,33. Откуда, кстати, берутся эти значения?</p>
<p>Это станет понятным, если взглянуть на формулу доверительных интервалов для t-критерия: <span class="math display">\[\left( \bar x + t_{n-1, \alpha / 2} \cdot \frac{s}{\sqrt{n}},
  \bar x + t_{n-1, 1 - \alpha / 2} \cdot \frac{s}{\sqrt{n}} \right)\]</span>,</p>
<p>где:</p>
<ul>
<li><span class="math inline">\(\bar{x}\)</span> - среднее значение</li>
<li><span class="math inline">\(t_{n-1, \alpha / 2}\)</span> - квантиль <span class="math inline">\(\alpha /2\)</span> t-распределения с <span class="math inline">\(n-1\)</span> степенями свободы</li>
<li><span class="math inline">\(s = \sqrt{\frac{1}{n-1} \sum_{i=1}^n (x_i - \bar{x})^2}\)</span> - выборочное стандартное отклонение</li>
<li><span class="math inline">\(n\)</span> - размер выборки</li>
</ul>
<p>Попробуем воспроизвести доверительные интервалы, используя возможности библиотеки <code>distributions3</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("distributions3")</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(distributions3)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>T_9<span class="ot">&lt;-</span><span class="fu">StudentsT</span>(<span class="at">df=</span><span class="dv">29</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data) <span class="sc">+</span> <span class="fu">quantile</span>(T_9, <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(data) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20730</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data) <span class="sc">+</span> <span class="fu">quantile</span>(T_9, <span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(data) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24856.33</code></pre>
</div>
</div>
<p>Мы получили аналогичные результаты, что нас утверждает в мысли, что мы на правильном пути. Посмотрим, как результаты проверки гипотезы с помощью t-критерия можно представить графически:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-t-test-plot" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-t-test-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-t-test-plot-1.png" id="fig-t-test-plot" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-t-test-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="критерий-уилкоксона" class="level3">
<h3 class="anchored" data-anchor-id="критерий-уилкоксона">Критерий Уилкоксона</h3>
<p>В том случае, когда по каким-то причинам мы не можем применять параметрические критерии (например, из-за погрешностей в распределении - слишком большой асимметрии), альтернативой z- и t-критериям может являться <strong>критерий знаковых рангов Уилкоксона (Wilcoxon signed-rank test)</strong>. Он был разработат Фрэнком Уилкоксонов в 1945 году, и является одним из самых первых «непараметрических» тестов.</p>
<p>В отличие от рассмотренных выше тестов в нем сравниваются не средние значения, а медианы, что делает тест устойчивым к экстремальным значениям.</p>
<p>Нулевая и альтернативная гипотезы также формулируются в терминах выборочной медианы (<span class="math inline">\(m\)</span>), которая сравнивается с другим медианным значением из генеральной совокупности, которое определяет исследователь:</p>
<ul>
<li><span class="math inline">\(H_0 : m = m_0\)</span></li>
<li><span class="math inline">\(H_1 : m \neq m_0\)</span> (двусторонняя)</li>
<li><span class="math inline">\(H_1 : m &gt; m_0\)</span> (правосторонняя)</li>
<li><span class="math inline">\(H_1 : m &lt; m_0\)</span> (левосторонняя)</li>
</ul>
<p>Как и в другом тесте здесь есть свои допущения:</p>
<ul>
<li>распределение оценок (различий между эмпирическим и теоретическим значением) должно быть симметричным (то есть должны быть разные данные - те, которые отклоняются от тестируемого значения в положительную сторону и в отрицательную сторону, в противном случае, тест проводить не стоит);</li>
<li>выборка должна быть случайной, а наблюдения независимыми друг от друга.</li>
</ul>
<p>Одновыборочный тест Уилкоксона основан на следующей тестовой статистике. Могут быть использованы два способа подсчета, которые приводят к идентичным результатам.</p>
<p>Обозначим первый как <span class="math inline">\(W_1\)</span> (также известный как <span class="math inline">\(T\)</span>), а второй как <span class="math inline">\(W_2\)</span>. Для того, чтобы посчитать статистику критерия по каждому способу, нужно осуществить следующие действия:</p>
<ol type="1">
<li>Для каждого значения выявить знак отличия с теоретическим значением: <span class="math inline">\(sign_d=sgn(score−m_0)\)</span> . Показатель <span class="math inline">\(sign\)</span> равен 1, если различия больше нуля, -1, если различия меньше нуля, и 0 - если равны нулю.</li>
<li>Для каждого значения посчитать абсолютную разницу с теоретическим значением: <span class="math inline">\(|score−m_0|\)</span>.</li>
<li>Удалить значения, различия по которым равны нулю (по этому поводу есть несколько спорных мнений - удалять или не удалять, а сдвигать значения на небольшую константу, но мы будем следовать «классическому объяснению»). После удаления «нулей» окончательный объем выборки становится равным <span class="math inline">\(N_r\)</span>.</li>
<li>Присвоить ранги <span class="math inline">\(R_d\)</span> всем абсолютным разностям в <span class="math inline">\(N_r\)</span>. Наименьшему значению присваивается ранг 1, а наибольшему - ранг, соответствующий <span class="math inline">\(N_r\)</span>. Если есть повторные ранги (ties), то они заменяются на средние значения.</li>
</ol>
<p>Далее необходимо посчитать сумму рангов, соответствующих положительным различиям: <span class="math inline">\(W_1=\Sigma R^+_d\)</span></p>
<p>и</p>
<p><span class="math inline">\(W_2=\Sigma sign_d × R_d\)</span> (то есть просто умножить разницу на знак, а затем суммировать все произведения).</p>
<p>Распределение статистики <span class="math inline">\(W_1\)</span> при условии, что верна нулевая гипотеза (<span class="math inline">\(H_0\)</span>) и <span class="math inline">\(N_r\)</span> достаточно большое, приближается к нормальному со средним значением <span class="math inline">\(\mu W_1\)</span> и стандартным отклонением <span class="math inline">\(\sigma W_1\)</span>, которые рассчитываются по следующим формулам:</p>
<p><span class="math display">\[\mu_{W_1} = \frac{N_r(N_r + 1)}{4}\]</span> и</p>
<p><span class="math display">\[\sigma_{W_1} = \sqrt{\frac{N_r(N_r + 1)(2N_r + 1)}{24}}\]</span></p>
<p>Следовательно, стандартизированная z-статистика принимает следующий вид:</p>
<p><span class="math display">\[z = \frac{W_1 - \mu_{W_1}}{\sigma_{W_1}}\]</span></p>
<p>Распределение статистики <span class="math inline">\(W_2\)</span> при достаточно большом количестве выборки также имеет нормальное распределение со средним значением <span class="math inline">\(0\)</span> и стандартным отклонением <span class="math inline">\(\sigma W_2\)</span>:</p>
<p><span class="math display">\[ \sigma_{W_2} = \sqrt{\frac{N_r(N_r + 1)(2N_r + 1)}{6}}\]</span></p>
<p>Стандартизированная статистика рассчитывается в этом случае по формуле:</p>
<p><span class="math display">\[z = \frac{W_2}{\sigma_{W_2}}\]</span></p>
<p>Если выборки маленькие (менее 50 наблюдений), следует использовать точные распределения.</p>
<p>Вернемся к нашему первому примеру и попробуем применить к этим же данным тест Уилкоксона:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">100</span>, <span class="at">mean =</span> <span class="fl">6.8</span>, <span class="at">sd =</span> <span class="fl">1.2</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">wilcox.test</span>(data, <span class="at">mu =</span> <span class="fl">6.5</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the results</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  data
V = 3506, p-value = 0.0007482
alternative hypothesis: true location is not equal to 6.5</code></pre>
</div>
</div>
</section>
</section>
<section id="сравнение-исследуемого-признака-в-двух-и-более-независимых-выборках" class="level2">
<h2 class="anchored" data-anchor-id="сравнение-исследуемого-признака-в-двух-и-более-независимых-выборках">Сравнение исследуемого признака в двух и более независимых выборках</h2>
<section id="t-критерий" class="level3">
<h3 class="anchored" data-anchor-id="t-критерий">t-критерий</h3>
<p>Т-критерий для независимых выборок (t-тест, t-критерий Стьюдента) предназначен для сравнения средних в двух независимых группах с целью предоставления статистического обоснования того, что и в основной популяции (генеральной совокупности) соответствующие средние так же различаются. Своим именем этот критерий обязан английскому химику и математику <strong>Уильяму Сили Госсету</strong>, работавшему в конце XIX века на пивоварне Гиннесс в Дублине. Владельцы пивоварни поставили перед ученым весьма амбициозную задачу - сохранить репутацию лучших пивоваров и вывести процесс производства пива на новый уровень, что потребовало проведения исследований в области контроля качества. Как известно, производство пива - процесс не только высокотехнологичный, требующий четкости следования процедурам, но и результат случайного стечения обстоятельств, поскольку натуральные продукты, из которых производится пиво - хмель, ячмень, солод, как и другие сельскохозяйственные культуры, имеют большую степень вариабельности вкусовых качеств из-за влияния состава почвы, климата и других факторов. Задача Госсета как подмастерья пивовара заключалась не только в оценке качества этих продуктов, но и том, чтобы сделать это наиболее экономным и точным образом.</p>
<div id="fig-gosset" class="quarto-figure quarto-figure-center quarto-float anchored" style="&quot;float:left">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gosset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/William_Sealy_Gosset_Chemist_%26_Statistician_1876_-_1937_Chief_Brewer_Student_%27t%27_test.jpg/800px-William_Sealy_Gosset_Chemist_%26_Statistician_1876_-_1937_Chief_Brewer_Student_%27t%27_test.jpg" class="img-fluid figure-img" style="&quot;float:left">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gosset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Памятная табличка в Дублине, на складе пивоварни Гиннесс
</figcaption>
</figure>
</div>
<p>Работая с небольшими выборками, Госсет заметил, что распределение средних значений отклонялось от нормального распределения, и, значит, он не мог использовать обычные статистические методы, основанные на нормальном распределении для того, чтобы принимать решения.</p>
<p>В 1904 году Госсет опубликовал внутренний отчет, в котором математически обосновал свой «закон ошибок» среднего (Law of Error) и возможности его применения для нужд пивоварни. В своей работе он описал, что «чем больше наблюдений, по которым рассчитано среднее значение, тем меньше (вероятная) ошибка». Госсет также отметил, что в сравнении с нормальным распределением, «кривая, представляющая частоту ошибок становится выше и уже по мере того, как объем выборки уменьшается. Управление Гинесса предложило Госсету проконсультироваться с другими специалистами, и так состоялась встреча Госсета с Карлом Пирсоном, под руководством которого в 1908 году в журнале «Биометрика» и появляется знаменитая работа Госсета об оценке ошибки среднего, напсанная под псевдонимом Стьюдент. Госсет не мог публиковаться под своим собственным именем, поскольку речь шла о данных, составляющих коммерческую тайну, а завод Гинесса очень строго относился к своим данным. Поэтому, вероятно, под влиянием названия на блокноте, который он использовал для ведения записей (The Student’s Science Notebook), Госсет выбрал такой псевдоним, который он использовал в 19 из своих 21 научных работ (<span class="citation" data-cites="ziliak2008great">(<a href="#ref-ziliak2008great" role="doc-biblioref"><strong>ziliak2008great?</strong></a>)</span>).</p>
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon> <strong>Примеры</strong>: сравнение результатов академической успеваемости в двух группах учащихся, доходов у мужчин и женщин, доверия к социальным институтам среди городских и сельских жителей и др.</p>
<p>Требования:</p>
<ol type="1">
<li>Зависимая переменная должна быть <strong>непрерывной</strong>, измеренной по интервальной шкале или шкале отношений Независимая переменная - категориальная (номинальная), состоящая из двух и более групп (но мы сравниваем только две)</li>
<li>Для анализа отбираются только случаи, где есть валидные значения по обеим переменным (отсутствующие значения удаляются)</li>
<li>Сравниваемые группы должны быть <strong>независимыми</strong> (должно выполняться требование независимости наблюдений). Что это значит?</li>
</ol>
<ul>
<li>Между наблюдениями в разных группах нет никаких взаимосвязей, то есть:</li>
<li>Субъекты (респонденты) в первой группе не могут быть одновременно и во второй группе (респонденты в каждой группе - разные)</li>
<li>Субъекты (респонденты) одной группы никаким образом не могут влиять на субъектов (респондентов) в другой группе (например, в одной группе - родители, в другой - дети, или в одной начальники, а в другой - подчиненные и т. д.) Независимость двух выборок означает, что средние значения «будут совершенно некоррелируемыми для бесконечного множества пар выборок».</li>
</ul>
<ol start="4" type="1">
<li>Выборка должна быть случайной</li>
<li>Зависимая переменная в каждой группе должна быть нормально распределена Ненормальное распределение, особенно с «тяжелыми хвостами» или слишком большой асимметрией значительно снижает мощность теста (его способность отвергать нулевую гипотезу) В случае если выборка по размеру средняя или большая, нарушениями нормальности можно пренебречь, так как они меньше влияют на величину ошибки <span class="math inline">\(p\)</span>.</li>
<li>Гомогенность дисперсий (то есть дисперсии в группах должны быть практически равными) Когда это требование нарушается и размеры групп не совпадают, значению <span class="math inline">\(p\)</span> нельзя доверять.К счастью, R позволяет рассчитать модифицированную статистику t-критерия по формулам, которые не основываются на допущении о равенстве дисперсий. Этот альтернативный критерий носит название t-критерия Уэлча, он также известен под названиями t-критерия для неравных дисперсий (Unequal Variance t-Test или Separate Variances t-Test).</li>
<li>В измерениях не должно быть выбросов (можно проверить по ящичной диаграмме).</li>
</ol>
<p>Нулевая гипотеза (<span class="math inline">\(H_0\)</span>) и альтернативная гипотеза (<span class="math inline">\(H_1\)</span>) при использовании t-критерия Стьюдента может быть выражена двумя аналогичными способами:</p>
<ul>
<li><span class="math inline">\(H_0: \mu_1 = \mu_2\)</span> («средние в двух группах равны»)</li>
<li><span class="math inline">\(H_1: \mu_1 \neq \mu_2\)</span> («средние в двух группах не равны»)</li>
</ul>
<p>ИЛИ</p>
<ul>
<li><span class="math inline">\(H_0: \mu_1- \mu_2 = 0\)</span> («различия между средними равны 0»)</li>
<li><span class="math inline">\(H_1:\mu_1 - \mu_2 \neq 0\)</span> («различия между средними в двух группах не равны 0»)</li>
</ul>
<p>где <span class="math inline">\(µ_1\)</span> и <span class="math inline">\(µ_2\)</span> это средние в генеральной совокупности для группы 1 и группы 2, соответственно. Заметим, что вторая группа гипотез выводится просто путем переноса <span class="math inline">\(\mu_2\)</span> в левую часть уравнения (неравенства) - или путем ее вычитания из обеих частей.</p>
<p>Когда доказано, что две выборки происходят из групп генеральной совокупности с равными дисперсиями <span class="math inline">\(\sigma^2_1=\sigma^2_2\)</span>), статистика t-критерия рассчитывается по формулам:</p>
<p><span class="math display">\[t=\frac{\bar{x_1}-\bar{x_2}}{s_p/\sqrt{n_\sigma}}\]</span></p>
<p>где</p>
<p><span class="math display">\[s_p=\sqrt{\frac{(n_1-1)*s^2_1+(n_2-1)*s^2_2}{n_1+n_2-2}}\]</span></p>
<p>а</p>
<p><span class="math display">\[n_\sigma=\frac{1}{\frac{1}{n_1}+\frac{1}{n_2}}\]</span></p>
<p>где <span class="math inline">\(\bar{x_1}\)</span>,<span class="math inline">\(\bar{x_2}\)</span> – средние значения в сравниваемых выборках, <span class="math inline">\(n_1, n_2\)</span> – количество наблюдений в первой и второй группах, <span class="math inline">\(s_1, s_2\)</span> – стандартные отклонения в первой и второй группах, <span class="math inline">\(s_p\)</span> – объединенное стандартное отклонение.</p>
<p>Распределение статистики t-критерий является t-распределением Стьюдента с <span class="math inline">\(df\)</span> - степенями свободы. Если гипотеза о равенстве дисперсий подтверждается, то количество степеней свободы подсчитывается по формуле <span class="math inline">\(n_1+n_2-2\)</span>.</p>
<p>Когда независимые выборки (и соответствующие им группы в генеральной совокупности) имеют неравные дисперсии (то есть, <span class="math inline">\(𝜎_1^2≠𝜎_2^2\)</span>), t-критерий рассчитывается по формуле (известной также как t-критерий Уэлча):</p>
<p><span class="math display">\[t=\frac{\bar{x_1}-\bar{x_2}}{\sqrt{\frac{s^2_1}{n_1}+\frac{s^2_2}{n_2}}}\]</span> где (<span class="math inline">\(\bar{x_1}, \bar{x_2}\)</span>,– средние значения в сравниваемых выборках,<span class="math inline">\(n_1, n_2\)</span> - количество наблюдений в первой и второй группах, <span class="math inline">\(s_1, s-2\)</span> – стандартные отклонения в первой и второй группах.</p>
<p>Количество степеней свободы при этом высчитывается по формуле: <span class="math display">\[df=\frac{(\frac{s^2_1}{n_1}+\frac{s^2_2}{n_2})^2}{\frac{1}{n_1-1}(\frac{s^2_1}{n_1})^2+\frac{1}{n_2-1}(\frac{s^2_2}{n_2})^2}\]</span> Полученная статистика <span class="math inline">\(t\)</span> сравнивается с критическими значениями из таблиц с t-распределения Стьюдента для количества степеней свободы и выбранного уровня значимости α (как правило 0,05). Если рассчитанное значение t больше табличного, мы отвергаем нулевую гипотезу (<span class="math inline">\(H_0\)</span>) о равенстве средних значений.</p>
<p>Рассмотрим возможности анализа данных с помощью t-критерия Стьюдента на следующем примере.</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon> <strong>Пример</strong>: В нашем исследовании по климату есть переменные, оценивающие важность для коренных народов, проживать на территории традиционного проживания, соблюдать обычаи и этнические традиции, осуществлять традиционную хозяйственную деятельность. Это табличный вопрос <strong>В18</strong>. Создадим усредненное значение по пяти подвопросам данного блока и используем его в качестве обобщенной оценки важности сохранения традиционных основ жизнедеятельности коренных народов, проживающих на высокогорных территориях. Проведем сравнительный анализ средних оценок в различных возрастных группах - в группе молодежи до 35 лет и среди жителей старше 35-летнего возраста.</p>
</blockquote>
<p>Загрузим данные:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">read_sav</span>(<span class="st">"База_КлимРиск_2023.sav"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Посчитаем новую переменную - среднее значение по переменным B18_1 - B18_5 и сделаем гистограмму:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">V18_mean=</span><span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">"V18"</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>V18_mean, <span class="at">col=</span><span class="st">"steelblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Мы видим, что наши данные весьма далеки от совершенства, и есть значительная отрицательная асимметрия, происходящая оттого, что большинство опрошенных дали самые высокие оценки значимости по всем пяти подвопросам. Строго говоря, с такими данными применять t-критерий не совсем корректно, и любой тест на нормальность это подтвердит.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(df<span class="sc">$</span>V18_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df$V18_mean
W = 0.80376, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(psych<span class="sc">::</span><span class="fu">describe</span>(df<span class="sc">$</span>V18_mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   X1
vars       1.00000000
n        884.00000000
mean       3.44560709
sd         0.68243009
median     3.80000000
trimmed    3.56541902
mad        0.29652000
min        1.00000000
max        4.00000000
range      3.00000000
skew      -1.24143852
kurtosis   0.92310844
se         0.02295261</code></pre>
</div>
</div>
<p>Так и есть, у нас асимметрия превышает допустимые пределы от +1 до -1 (Hair et al., 2022). Но исключительно в учебных целях мы продолжим.</p>
<p>Создадим группирующую переменную по возрасту:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_bin=</span><span class="fu">case_when</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    age<span class="sc">&lt;</span><span class="dv">35</span> <span class="sc">~</span> <span class="st">"До 35 лет"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    age<span class="sc">&gt;=</span><span class="dv">35</span> <span class="sc">~</span> <span class="st">"Старше 35 лет"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>      ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Для проверки гомогенности дисперсий в группах проведем лест Ливиня, преимуществом которого является возможность использования, когда в данных есть отклонения от нормальности:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(V18_mean<span class="sc">~</span>age_bin, <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
       Df F value  Pr(&gt;F)  
group   1  5.7383 0.01681 *
      858                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Судя по тесту, у нас значимые различия в дисперсиях, а значит, если уж использовать t-критерий, то его модифицированную версию Уэлча:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(V18_mean<span class="sc">~</span>age_bin, <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  V18_mean by age_bin
t = -3.362, df = 414.04, p-value = 0.0008457
alternative hypothesis: true difference in means between group До 35 лет and group Старше 35 лет is not equal to 0
95 percent confidence interval:
 -0.28310252 -0.07419598
sample estimates:
    mean in group До 35 лет mean in group Старше 35 лет 
                   3.314108                    3.492757 </code></pre>
</div>
</div>
<p>Тест показал наличие значимых отличий в оценке важности традиционной деятельности по возрасту (<span class="math inline">\(t_{414,04}=-3,362, p = 0,001\)</span>), указывающий на то, что современная молодежь, проживающая вблизи ледников, в меньшей степени ориентирована на сохранение традиционных ценностей и устоев своего народа.</p>
<p>Создадим визуализацию к результатам теста:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_bin)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggboxplot</span>(<span class="at">x =</span> <span class="st">"age_bin"</span>, <span class="at">y =</span> <span class="st">"V18_mean"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"age_bin"</span>, <span class="at">palette =</span> <span class="st">"jco"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"До 35 лет"</span>, <span class="st">"Старше 35 лет"</span>), <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">xlab =</span> <span class="st">"Возраст"</span>, )<span class="sc">+</span><span class="fu">stat_compare_means</span>(<span class="at">method =</span> <span class="st">"t.test"</span>, <span class="at">label.y =</span> <span class="fl">4.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-t-test" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-t-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-t-test-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-t-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Ящичная диаграмма по результатам рассчета t-критерия (ggpubr)
</figcaption>
</figure>
</div>
</div>
</div>
<p>Либо как вариант:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(df, age_bin, V18_mean, <span class="at">xlab =</span> <span class="st">"Возраст"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-t-test2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-t-test2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-t-test2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-t-test2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Ящичная диаграмма по результатам рассчета t-критерия (ggstatsplot)
</figcaption>
</figure>
</div>
</div>
</div>
<p>Несмотря на то, что различия статистически достоверны, величина эффекта представляющая собой стандартизованную разницу между средними, невысока: Hedges’ g (метрика, позволяющая оценить различия в средних) составляет всего 0,26, что можно считать очень незначительной разницей (согласно негласным нормам средний эффект наблюдается при g = 0,5, значительный - при g выше 0,8).</p>
</section>
<section id="u-критерий-манна-уитни" class="level3">
<h3 class="anchored" data-anchor-id="u-критерий-манна-уитни">U-критерий Манна-Уитни</h3>
<p>Критерий Манна-Уитни (U критерий, также называемый критерием Манна-Уитни-Вилкоксона, MWW/MWU, критерием ранговых сумм Вилкоксона, тестом Вилкоксона-Манна-Уитни) – непараметрический тест, проверяющий нулевую гипотезу о том, что в случайных значениях двух групп X и Y вероятность того, что X больше Y равна вероятности, что Y больше, чем X.</p>
<p>Предложен в 1945 году американским химиком и статистиком Фрэнком Уилкоксоном, доработан австрийским и американским математиком Генри Манном и Дональдом Уитни в 1947 году.</p>
<p>U-критерий Манна-Уитни используется для сравнения выраженности показателей в двух несвязных (независимых) выборках, является непараметрическим аналогом t-критерия Стьюдента.</p>
<p>Требования:</p>
<ol type="1">
<li>Все наблюдения из двух групп должны быть независимыми друг от друга</li>
<li>Данные должны быть измеренными по крайней мере в порядковой шкале (взяв два значения мы должны точно сказать, какое из них больше)</li>
<li>Нулевая гипотеза <span class="math inline">\(H_0\)</span> предполагает, что распределения в двух группах являются идентичными Альтернативная гипотеза <span class="math inline">\(H_1\)</span> заключается в том, что распределения не идентичны.</li>
</ol>
<p>Для применения U-критерия Манна — Уитни нужно:</p>
<ol type="1">
<li>Составить единый ранжированный ряд из обеих сопоставляемых выборок, расставив их элементы по степени нарастания признака и приписав меньшему значению меньший ранг. Общее количество рангов получится равным: <span class="math inline">\(N=n_1+n_2\)</span>, где <span class="math inline">\(n_1\)</span> — количество элементов в первой выборке, а <span class="math inline">\(n_2\)</span> — количество элементов во второй выборке.</li>
<li>Разделить единый ранжированный ряд на два, состоящие соответственно из единиц первой и второй выборок. Подсчитать отдельно сумму рангов, пришедшихся на долю элементов первой выборки, и отдельно — на долю элементов второй выборки.</li>
<li>Определить значение U-критерия Манна — Уитни <strong>в каждой группе</strong> по формуле:</li>
</ol>
<p><span class="math display">\[U_x=T_x-\frac{n_x(n_x+1)}{2},\]</span> где <span class="math inline">\(T_x\)</span> - сумма рангов.</p>
<p>Меньшее значение и будет итоговым значением критерия.</p>
<ol start="4" type="1">
<li>По таблице для избранного уровня статистической значимости определить критическое значение критерия для данных <span class="math inline">\(n_1\)</span> и <span class="math inline">\(n_2\)</span>. Если полученное значение <span class="math inline">\(U\)</span> меньше табличного или равно ему, то признается наличие существенного различия между уровнем признака в рассматриваемых выборках (принимается альтернативная гипотеза). Если же полученное значение <span class="math inline">\(U\)</span> больше табличного, принимается нулевая гипотеза. Достоверность различий тем выше, чем меньше значение <span class="math inline">\(U\)</span>.</li>
</ol>
<p>Проведем тест Манна-Уитни с примером выше:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(V18_mean<span class="sc">~</span>age_bin, <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  V18_mean by age_bin
W = 62591, p-value = 0.0001254
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>Результаты аналогичны полученным с помощью t-критерия.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(df, age_bin, V18_mean, <span class="at">xlab =</span> <span class="st">"Возраст"</span>, <span class="at">type=</span><span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-u-test" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-u-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-u-test-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-u-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Ящичная диаграмма по результатам рассчета U-критерия (ggstatsplot)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="однофакторный-дисперсионный-анализ" class="level3">
<h3 class="anchored" data-anchor-id="однофакторный-дисперсионный-анализ">Однофакторный дисперсионный анализ</h3>
<p>Дисперсионный анализ (Analysis of Variance, ANOVA) – статистический метод выявления различий между выборочными средними для двух или больше совокупностей.</p>
<p>Существуют различные разновидности дисперсионного анализа, различающиеся по количеству группирующих (факторных) и зависимых переменных, используемых в анализе, типам выборок (независимые наблюдения или повторные эксперименты), наличию кластеров внутри выборки и др.</p>
<p>Самым простым является однофакторный дисперсионный анализ (One-way или one-factor ANOVA), в котором используются одна зависимая и одна независимая переменные.</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon> <strong>Например</strong>, нас может интересовать влияние принадлежности к тому или иному социальному классу (низший, средний и высший класс) на показатели здоровья, такие как доступ к медицинским услугам или распространенность хронических заболеваний, или мы могли бы сравнить, как лица с различным уровнем религиозности (высокорелигиозные, со средней религиозностью или совсем не религиозности) оценивают уровень социальной справедливости или проявляют электоральное поведение, а также как уровень потребления медиаконтента (например, заядлые ТВ-зрители или типичные пользователи социальных сетей или читатели определенных газет) взаимосвязан с установками в отношении социальных проблем, так как проблемы миграции или гендерного неравенства.</p>
</blockquote>
<p>При этом, мы предполагаем, что исходные значения зависимой переменной можно разложить на несколько компонентов, определяющих различия между ними:</p>
<p><span class="math display">\[x_{ij}=\mu + F_i+ \epsilon_{ij}, \]</span> где</p>
<ul>
<li><span class="math inline">\(x_{ij}\)</span> - значение зависимой переменной, полученной на <span class="math inline">\(i-м\)</span> уровне фактора с порядковым номером <span class="math inline">\(j\)</span>;</li>
<li><span class="math inline">\(\mu\)</span> - общее среднее значение;</li>
<li><span class="math inline">\(F_i\)</span> - эффект, обусловленный влиянием <span class="math inline">\(i-го\)</span> уровня фактора;</li>
<li><span class="math inline">\(\epsilon_{ij}\)</span> - остаточный член, возмущение, вызванное влиянием неконтролируемых факторов, то есть вариацией переменной внутри уровня.</li>
</ul>
<p>Гипотезы:</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\mu_1=\mu_2=\mu_3=...= \mu_k\)</span></li>
<li><span class="math inline">\(H_1\)</span>: не все средние равны (хотя бы между одной парой средних имеются различия)</li>
</ul>
<p>Дисперсионный анализ сравнивает дисперсии двух видов — внутри групп (связанную со случайными, неконтролируемыми различиями между испытуемыми) и между группами (связанную с влиянием группирующей переменной, или фактора). Как мы увидели выше, при сравнении двух групп t-статистика измеряет разность средних стандартной ошибкой. Дисперсионный анализ измеряет квадрат разности средних квадратами стандартной ошибки, т.е. результат для двух выборок равен квадрату, рассчитанной по этим же данным t-статистики.</p>
<p><strong>Межгрупповая (факторная) дисперсия</strong> рассчитывается по формуле:</p>
<p><span class="math display">\[MS_b=\frac{SSb}{k-1},\]</span> где</p>
<ul>
<li><span class="math inline">\(SS_b=\Sigma n_i(\bar{x_i}-\bar{x})\)</span> - межгрупповая сумма квадратов отклонений среднего значения в каждой группе от общего среднего;</li>
<li><span class="math inline">\(k-1\)</span> - степень свободы (количество уровней группирующей переменной минус единица).</li>
</ul>
<p><strong>Внутригрупповая (остаточная) дисперсия</strong>:</p>
<p><span class="math display">\[MS_w=\frac{SSw}{N-k},\]</span> где</p>
<p><span class="math inline">\(SS_w=\Sigma(x-\bar{x_i})\)</span> - внутригрупповая сумма квадратов отклонений <span class="math inline">\(N-k\)</span> - количество степеней свободы</p>
<p>Общая сумма квадратов отклонений есть сумма межгрупповых и внутригрупповых квадратов отклонений:</p>
<p><span class="math display">\[SS=SS_w+SS_b\]</span> Результаты вычислений можно представлять в виде следующей таблицы:</p>
<p><img src="images/StatInf/ss.png" class="img-fluid"></p>
<p>Основной в дисперсионном анализе является статистика <span class="math inline">\(F\)</span>, показываются соотношение между межгрупповой и внутригрупповой дисперсиями. Если межгрупповая дисперсия существенно выше, чем внутригрупповая, то между изучаемыми группами (уровнями) существуют статистически значимые различия.</p>
<p><span class="math display">\[F=\frac{MS_b}{MS_w}\]</span></p>
<div id="fig-anova" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.datanovia.com/en/wp-content/uploads/dn-tutorials/r-statistics-2-comparing-groups-means/images/one-way-anova-basics.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Межгрупповая и внутригрупповая дисперсии
</figcaption>
</figure>
</div>
<section id="множественные-сравнения-post-hoc-tests-апостериорные-тесты" class="level4">
<h4 class="anchored" data-anchor-id="множественные-сравнения-post-hoc-tests-апостериорные-тесты">Множественные сравнения (post hoc tests – апостериорные тесты)</h4>
<p>Сам по себе дисперсионный анализ показывает, что есть различия хотя бы между одной парой средних значений (наличие общего эффекта). Но между какими именно группами? Обычно на вычислении <span class="math inline">\(F\)</span> все не заканчивается, а только начинается.</p>
<p>Первое, что может прийти в голову: почему бы не сравнить группы попарно с помощью того же t-критерия? Однако, все не так просто, поскольку когда групп много, возникает проблема одновременной проверки множественных гипотез.</p>
<p>Вкратце, эта проблема заключается в том, что при одновременной проверке большого числа гипотез на том же наборе данных вероятность сделать неверное заключение в отношении хотя бы одной из этих гипотез значительно превышает изначально принятый уровень значимости (<span class="math inline">\(\alpha\)</span>).</p>
<p>Так, если мы будем сравнивать десять групп по тридцать испытуемых в каждой, то мы практически всегда найдем отличие лучшей группы от худшей на уровне значимости меньше 0.05, даже если группы эти набирались совершенно случайно и ни о каком воздействии, которое могло бы привести к систематическому сдвигу среднего значения, речи не шло. Например, вы можете сравнить пассажиров десяти вагонов поезда по тесту, измеряющему социальную дистанцию к какой-либо группе и убедиться, что значимость отличия лучшего вагона от худшего по Т-критерию, как правило, меньше 0.05.</p>
<p>Можно сказать, что 10(10−1)/2 (число сочетаний из 10 по 2) попарных сравнений «всех со всеми» практически гарантируют хотя бы одну ошибку первого рода, т.е. отвержение гипотезы <span class="math inline">\(H_0\)</span>, когда она на самом деле верна.</p>
<p>Когда мы сравниваем три группы (например, А и В, А и С, В и С), вероятность совершить ошибку хотя бы в одном из этих трех сравнений составит:</p>
<p><span class="math display">\[P' = 1 - (1 - \alpha)^m =  1- (1 - 0.05)^3 = 0.143,\]</span> Если же количество сравнений 45, как в примере с 10 вагонами (10*9/2=45), то вероятность ошибки начинает превышать 90%:</p>
<p><span class="math display">\[P' = 1 - (1 - \alpha)^m =  1- (1 - 0.05)^{45} = 0.90,\]</span></p>
<p>Что делать?</p>
<p>Для устранения эффекта множественных сравнений существует большой репертуар методов, позволяющих снизить вероятность ошибочного решения. Они различаются как своей консервативностью, так и условиями применения.</p>
<p>Одним из самых простых и известных способов контроля над групповой вероятностью ошибки является <em>Метод Бонферрони</em> (назван так в честь предложившего его итальянского математика Карло Эмилио Бонферрони; Carlo Emilio Boferroni). Он заключается в умножении полученных при сравнении групп p-значений на количество сравниваемых групп.</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon> <strong>Пример</strong>: Предположим, Предположим, что мы применили определенный статистический критерий 3 раза (например, сравнили при помощи критерия Стьюдента средние значения групп А и В, А и С, и В и С) и получили следующие три Р-значения: 0.01, 0.02 и 0.005. Чтобы применить метод Бонферрони, мы должны умножить каждое из p-значений на 3, а затем сравнить с выбранным уровнем значимости:</p>
<ul>
<li>0.01 * 3 = 0.03 &lt; 0.05: гипотеза отклоняется;</li>
<li>0.02 * 3 = 0.06 &gt; 0.05: гипотеза принимается;</li>
<li>0.005 * 3 = 0.015 &lt; 0.05: гипотеза отклоняется.</li>
</ul>
</blockquote>
<p>Хотя метод Бонферрони очень прост в реализации, он обладает одним существенным недостатком: при возрастании числа проверяемых гипотез мощность этого метода резко снижается. Другими словами, при возрастании числа гипотез нам будет все сложнее и сложнее отвернуть даже те из них,которые должны быть отвергнуты. Например, при проверке 10 гипотез, применение поправки Бонферрони привело бы к снижению исходного уровня значимости до 0.05/10 = 0.005. Соответственно, для отклонения той или иной гипотезы, соответствующие Р-значения должны были бы оказаться меньше 0.005, и такого условия достичь маловероятно. В связи с этим метод Бонферрони не рекомендуется использовать, если число проверяемых гипотез превышает 7-8.</p>
<p>Для преодоления проблем, связанных с низкой мощностью метода Бонферрони, в 1978 г. Стур Холм (Holm 1978) предложил гораздо более мощную его модификацию (часто этот метод называют еще методом Холма-Бонферрони). Этот модифицированный метод основан на алгоритме, который включает следующие шаги:</p>
<ul>
<li>Исходные Р-значения упорядочиваются по возрастанию: <span class="math inline">\(p_{(1)} \leq p_{(2)} \leq \dots \leq p_{(m)}\)</span>. Эти Р-значения соответствуют проверяемым гипотезам <span class="math inline">\(H_{(1)}, H_{(2)}, \dots H_{(m)}\)</span>.</li>
<li>Если <span class="math inline">\(p_{(1)} \geq \alpha/m\)</span>, все нулевые гипотезы <span class="math inline">\(H_{(1)}, H_{(2)}, \dots H_{(m)}\)</span> принимаются и процедура останавливается. Иначе следует отвергнуть гипотезу <span class="math inline">\(H_{(1)}\)</span> и продолжить.</li>
<li>Если <span class="math inline">\(p_{(2)} \geq \alpha/(m-1)\)</span>, нулевые гипотезы <span class="math inline">\(H_{(2)}, H_{(3)}, \dots H_{(m)}\)</span> принимаются и процедура останавливается. Иначе гипотеза <span class="math inline">\(H_{(2)}\)</span> отвергается и процедура продолжается.</li>
<li>…</li>
<li>Если <span class="math inline">\(p_{(m)} \geq \alpha\)</span>, нулевая гипотеза $H_{(m)} принимается и процедура останавливается.</li>
</ul>
<p>Описанную процедуру называют <em>нисходящей</em> (англ. step-down): она начинается с наименьшего P-значения в упорядоченном ряду и последовательно «спускается» вниз к более высоким значениям. На каждом шаге соответствующее значение <span class="math inline">\(p_{(i)}\)</span> сравнивается со скорректированным уровнем значимости <span class="math inline">\(\alpha / (m+i-1)\)</span>. Как и в случае с поправкой Бонферрони, вместо корректировки уровня значимости мы можем скорректировать непосредственно Р-значения - конечный результат (в смысле принятия или отклонения той или иной гипотезы) окажется идентичным. Соответствующая поправка выполняется в виде <span class="math inline">\(q_i = p_{(i)} (m + i -1)\)</span>. Так, для рассмотренного выше примера с тремя Р-значениями получаем:</p>
<ul>
<li><span class="math inline">\(q_1 = p_{(1)}(m - 1 + 1) = 0.005*3 = 0.015\)</span></li>
<li><span class="math inline">\(q_2 = p_{(2)}(m - 2 + 1) = 0.01*2 = 0.02\)</span></li>
<li><span class="math inline">\(q_3 = p_{(2)}(m - 3 + 1) = 0.02*1 = 0.02\)</span></li>
</ul>
<p>Именно последний подход реализован в R-функции p.adjust():</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Скорректированные Р-значения:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">p.adjust</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.005</span>), <span class="at">method =</span> <span class="st">"holm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.020 0.020 0.015</code></pre>
</div>
</div>
<p>На практике, в различных программах статистической обработки данных используются разные критерии для множественных сравнений.</p>
<p>Так, <strong>критерии диапазона</strong> выявляют однородные подмножества средних, не различающихся между собой. <strong>Парные множественные сравнения</strong> проверяют разности между каждой парой средних значений и выдают матрицу, в которой звездочками обозначены групповые средние, значимо различающиеся на уровне <span class="math inline">\(\alpha\)</span>.</p>
<p>Если требование о равенстве дисперсий выполняется, то рекомендуется использовать такие апостериорные тесты как <strong>Тьюки-b</strong>, С-Н-К (Стьюдента-Ньюмена-Келса), <strong>Дункана</strong>, Р-Э-Г-У&nbsp;F&nbsp;(&nbsp;F-критерий Райана-Эйнота-Габриэля-Уэлша), Р-Э-Г-У&nbsp;Q&nbsp;(критерий диапазона Райана-Эйнота-Габриэля-Уэлша) и Уоллера-Дункана, Бонферрони, <strong>Тьюки LSD</strong>, Шидака, Габриэля, Гохберга, Даннетта, Шеффе и НЗР (наименьшей значимой разности).</p>
<p>Если требование о равенстве дисперсий не выполняется: Тамхейна T2, Даннетта T3, <strong>Геймса-Хоуэлла</strong> и Даннетта&nbsp;C.</p>
<p>Продолжим наш пример с климатическими данными, однако, на этот раз, разделим выборку не на две, а на три возрастные группы, используя уже имеющуюся в наборе переменную <code>age_cat3</code>.</p>
<p>Поскольку нам нужна факторная переменная, прежде всего восстановим метки значений для этой переменной:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>age_cats3<span class="ot">&lt;-</span>sjlabelled<span class="sc">::</span><span class="fu">as_label</span>(df<span class="sc">$</span>age_cats3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Проведем тест на гомогенность дисперсий (тест Ливиня из библиотеки <code>rstatix</code> - не забываем, что ее нужно предварительно установить):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  rstatix<span class="sc">::</span><span class="fu">levene_test</span>(V18_mean <span class="sc">~</span> age_cats3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
    df1   df2 statistic      p
  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt;
1     2   857      2.62 0.0732</code></pre>
</div>
</div>
<p>Тест показывает отсутствие значимых различий, а значит, мы можем использовать «обычную» практику расчетов, в ппротивномслучае было бы лучше воспользоваться специальной формулой Уэлча, которая есть и для дисперсионного анализа.</p>
<p>Проведем дисперсионный анализ, используя функцию <code>anova_test</code> из уже упомянутого пакета <code>rstatix</code>. В качестве аргумента мы должны задать формулу: <code>V18_mean ~ age_cats3</code>, означающую, что мы хотим исследовать зависимость значений <code>V18_mean</code> от уровней факторной переменной <code>age_cats3</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>res.aov <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> rstatix<span class="sc">::</span><span class="fu">anova_test</span>(V18_mean <span class="sc">~</span> age_cats3)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>res.aov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ANOVA Table (type II tests)

     Effect DFn DFd    F        p p&lt;.05   ges
1 age_cats3   2 857 7.29 0.000725     * 0.017</code></pre>
</div>
</div>
<p>Значение <code>F</code> составило 7,29, весьма далеко от случайного отклонения:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pwc <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> rstatix<span class="sc">::</span><span class="fu">tukey_hsd</span>(V18_mean <span class="sc">~</span> age_cats3)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>pwc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  term      group1    group2      null.value estimate conf.low conf.high   p.adj
* &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 age_cats3 До 30 лет 31-49 лет            0   0.245    0.0930    0.397  4.82e-4
2 age_cats3 До 30 лет 50 лет и с…          0   0.204    0.0442    0.364  7.87e-3
3 age_cats3 31-49 лет 50 лет и с…          0  -0.0409  -0.163     0.0807 7.09e-1
# ℹ 1 more variable: p.adj.signif &lt;chr&gt;</code></pre>
</div>
</div>
<p>Визуализация результатов (первый вариант):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Прежде, чем создать визуализацию, создадим список пар групп, которые будем сравнивать</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>my_comparisons <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="st">"До 30 лет"</span>, <span class="st">"31-49 лет"</span>), <span class="fu">c</span>(<span class="st">"До 30 лет"</span>, <span class="st">"50 лет и старше"</span>), <span class="fu">c</span>(<span class="st">"31-49 лет"</span>, <span class="st">"50 лет и старше"</span>))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_cats3)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggviolin</span>(<span class="at">x =</span> <span class="st">"age_cats3"</span>, <span class="at">y =</span> <span class="st">"V18_mean"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"age_cats3"</span>, <span class="at">fill =</span> <span class="st">"age_cats3"</span>, <span class="at">add =</span> <span class="st">"boxplot"</span>, <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">"white"</span>), <span class="at">palette =</span> <span class="st">"jco"</span>,  <span class="at">xlab =</span> <span class="st">"Возраст"</span>, <span class="at">ylab =</span> <span class="st">"Оценка важности сохранения </span><span class="sc">\n</span><span class="st"> традиционных основ жизнедеятельности"</span>, <span class="at">legend.title =</span> <span class="st">"Возрастные группы"</span> )<span class="sc">+</span><span class="fu">stat_compare_means</span>(<span class="at">comparisons =</span> my_comparisons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-one-way-anova1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-one-way-anova1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-one-way-anova1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-one-way-anova1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Визуализация результатов однофакторного дисперсионного анализа (ggpubr)
</figcaption>
</figure>
</div>
</div>
</div>
<p>Визуализация результатов (вариант c помощью пакета <code>ggstatsplot</code>). Отметим, что по умолчанию функция основывается на предположении об отсутствии равенства дисперсий и использует критерий Геймса-Хоуэлла, поэтому результаты отличаются p-значениями, но общий вывод не меняется: основные различия пролегают между оценками младшей группы и всеми остальными.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  df,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> age_cats3,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> V18_mean,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"parametric"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Возраст"</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-one-way-anova2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-one-way-anova2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-one-way-anova2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-one-way-anova2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Визуализация результатов однофакторного дисперсионного анализа (ggstatsplot)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="однофакторный-непараметрический-дисперсионный-анализ-краскела-уоллиса" class="level3">
<h3 class="anchored" data-anchor-id="однофакторный-непараметрический-дисперсионный-анализ-краскела-уоллиса">Однофакторный непараметрический дисперсионный анализ Краскела-Уоллиса</h3>
<p>Адекватное применение дисперсионного анализа основывается на допущении о том, что зависимая переменная является непрерывной, имеет нормальное распределение и достаточно большую выборку (желательно <span class="math inline">\(n_j&gt; 30\)</span> где <span class="math inline">\(j=1, 2, ..., k\)</span>, а <span class="math inline">\(k\)</span> обозначает количество независимых сравниваемых групп). Дополнительно, ANOVA требует равенства дисперсий в сравниваемых выборках. Этот метод достаточно устойчив к отклонением, если выборки небольшие, но одинаковые. Когда есть проблемы с нормальностью или выборки маленькие и неравные, а также когда данные измерены в порядковой шкале, лучше использовать непараметрический аналог</p>
<p>Одним из часто используемых непараметрических аналогов, позволяющих сравнить более двух независимых группn, является критерий Краскела-Уоллиса (Kruskal Wallis test). Этот тест сравнивает распределения в k группах (k &gt; 2), при этом исходные данные также заменяются рангами. Является обобщением U-критерия Манна-Уитни для количества групп более двух.</p>
<p>Нулевая и альтернативная исследовательские гипотезы формулируются следующим образом:</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: Медианы в <span class="math inline">\(k\)</span> группах населения являются равными</li>
<li><span class="math inline">\(H_1\)</span>: Медианы в <span class="math inline">\(k\)</span> группах не равны</li>
</ul>
<p>Процедура тестирования предполагает проведение следующих шагов:</p>
<ol type="1">
<li>сведение всех <span class="math inline">\(k\)</span> выборок в один комбинированный набор</li>
<li>ранжирование всех значений от 1 до <span class="math inline">\(N\)</span>, где <span class="math inline">\(N = n_1+n_2 + ...+ n_k\)</span> и присвоение рангов</li>
<li>подсчет суммы рангов в каждой группе</li>
<li>вычисление статистики критерия</li>
<li>определение уровня значимости и формулировка вывода.</li>
</ol>
<p>Требования</p>
<ol type="1">
<li>Выборки являются случайными.</li>
<li>Наблюдения не зависят друг от друга</li>
<li>Как минимум порядковый уровень измерения для зависимой переменной и порядковый или номинальный – для независимого фактора.</li>
<li>Нет требований о характере распределения или нормальности данных.</li>
</ol>
<p>Формула для расчета H-критерия Краскела-Уоллиса:</p>
<p><span class="math display">\[H=\frac{12}{N(N+1)}\Sigma^k_{i=1}\frac{R^2_i}{n_i}-3(N+1)\]</span></p>
<p>где:</p>
<ul>
<li><span class="math inline">\(k\)</span> количество сравниваемых групп</li>
<li><span class="math inline">\(N\)</span> - общий объем выборки</li>
<li><span class="math inline">\(n_i\)</span> - объем выборки в группе <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(R_i\)</span> - сумма рангов в группе <span class="math inline">\(i\)</span>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(V18_mean <span class="sc">~</span> age_cats3, <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  V18_mean by age_cats3
Kruskal-Wallis chi-squared = 17.074, df = 2, p-value = 0.0001961</code></pre>
</div>
</div>
<p>Мы также можем сделать парные сравнения:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.wilcox.test</span>(df<span class="sc">$</span>V18_mean, df<span class="sc">$</span>age_cats3,  <span class="at">p.adjust.method =</span> <span class="st">"BH"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pairwise comparisons using Wilcoxon rank sum test with continuity correction 

data:  df$V18_mean and df$age_cats3 

                До 30 лет 31-49 лет
31-49 лет       0.00014   -        
50 лет и старше 0.00428   0.18172  

P value adjustment method: BH </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  df,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> age_cats3,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> V18_mean,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"non-parametric"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Возраст"</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-h-test" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-h-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Statistical-Inference_files/figure-html/fig-h-test-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-h-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Визуализация результатов непараметрического однофакторного дисперсионного анализа (ggstatsplot)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="самостоятельная-работа" class="level2">
<h2 class="anchored" data-anchor-id="самостоятельная-работа">Самостоятельная работа</h2>
<ol type="1">
<li>Проанализируйте различия в оценках уверенности в нахождении заработка в случае потери актуального места работы (вопрос В21) в зависимости от образовательного уровня респондента (вопрос А6), перекодировав его в две категории - те, кто имеют высшее образование, и кто его не имеет.</li>
<li>Используя созданную переменную важности соблюдения традиций, проведите анализ по уровню образования (по переменной, созданной в упр.1) и по самооценке материального положения (вопрос А10), создав три категории - «низкие доходы», «средние доходы» и «высокие доходы, обеспеченные граждане». Используйте параметрические методы там, где это уместно, и непараметрические там, где возможно применение только таких методов. Обязательно создайте визуализации к вашим результатам.</li>
<li>Оформите ваши результаты любым удобным для вас способом и приложите в качестве ответа на задание.</li>
</ol>
</section>
<section id="анализ-зависимых-выборок" class="level2">
<h2 class="anchored" data-anchor-id="анализ-зависимых-выборок">Анализ зависимых выборок</h2>
<p>Напомним, что зависимые (иногда их еще называют связанные, парные) выборки представляют собой данные, в которых каждому наблюдению в одном датасете соответствует другое, связанное с ним наблюдение в другом наборе данных.</p>
<p>Например, могут сравниваться:</p>
<ul>
<li>измерения в разные периоды времени (до и после лечения, обучения, смены работы и пр.)</li>
<li>условия, в которых были проведены измерения (лекарство натощак или после завтрака, выполнение теста с предварительным тренингом и без, результаты адаптации мигрантов через программу интеграции и без нее и др.)</li>
<li>результаты разных измерений (разные тесты тревожности, например)</li>
<li>спаренные пары, имеющие сходные характеристики (например, при сравнении результатов различных образовательных программ).</li>
</ul>
<p>Для анализа результатов таких исследований требуются особые статистические методы, которые мы будем обсуждать в данном разделе.</p>
<div id="fig-paired-samples" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-paired-samples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.statology.org/wp-content/uploads/2020/12/pairedData1-300x245.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-paired-samples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Связь между наблюдениями в зависимых выборках. Источник: www.statology.org
</figcaption>
</figure>
</div>
<section id="t-критерий-для-зависимых-выборок" class="level3">
<h3 class="anchored" data-anchor-id="t-критерий-для-зависимых-выборок">t-критерий для зависимых выборок</h3>
<p>Аналогично ситуациям, рассмотренным выше, t-критерий для зависимых выборок также используется для того, чтобы сравнить средние значения, но при этом предполагается, что группы связаны друг с другом каким-то образом. Чаще всего речь идет об одних и тех же испытуемых (респондентах, наблюдениях), у которых измеряется один и тот же показатель через некоторый промежуток времени. Однако, это могут быть и разные люди (объекты исследования), но выборки все равно проектируются как связанные.</p>
<div id="fig-ttest" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ttest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/StatInf/ttest.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ttest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Отличия между различными критериями
</figcaption>
</figure>
</div>
<p>Будучи параметрической процедурой, в которой оцениваются неизвестные параметры, t-критерий основывается на некоторых допущениях, проверка которых обычно осуществляется перед проверкой статистических гипотез. Поскольку речь идет о зависимых выборках, в качестве наблюдений учитываются не исходные данные, а различия между двумя наборами значений, и каждое допущение касается именно этих различий, а не исходных данных. Таких допущений четыре:</p>
<ul>
<li><p>Зависимая переменная должна быть непрерывной (интервальная шкала / шкала отношений). В отдельных случаях могут использоваться дискретные шкалы (например, в ходе измерения социальных установок с помощью шкал Лайкерта).</p></li>
<li><p>Наблюдения должны быть независимы друг от друга (различия между парами по одной строке не должны зависеть от различий по другим строкам).</p></li>
<li><p>Зависимая переменная (то есть различия между значениями) должна иметь нормальное распределение.</p></li>
<li><p>У зависимой переменной не должно быть выбросов.</p></li>
</ul>
<p>Как всегда, формулируем гипотезы:</p>
<p><span class="math inline">\(H_0:μ_d=0\)</span> – разница в средних значениях двух спаренных выборок равна нулю</p>
<p><span class="math inline">\(H_1:μ_d≠0\)</span> - (двухсторонний) разница в средних значениях двух выборок – не равна нулю <span class="math inline">\(H_1:μ_d&gt;0\)</span> - (правосторонний) – разница больше нуля</p>
<p><span class="math inline">\(H_1:μ_d&gt;0\)</span> - (левосторонний) – разница меньше нуля</p>
<p><strong>Порядок вычислений</strong>:</p>
<ul>
<li>Посчитать различия в значениях между двумя измерениями – <span class="math inline">\(D\)</span></li>
<li>Посчитать среднее значение получившихся различий <span class="math inline">\(d_1, d_2, … , d_n\)</span>:</li>
</ul>
<p><span class="math display">\[\bar{d}=\frac{d_1+d_2+...+ d_n}{n}\]</span> - Посчитать значение t-критерия по формуле:</p>
<p><span class="math display">\[t = \frac{\bar{d}}{s/\sqrt{n}},\]</span> где <span class="math inline">\(s\)</span> - стандартное отклонение различий (<span class="math inline">\(d\)</span>), <span class="math inline">\(n\)</span> - объем выборки (количество пар значений, по которым высчитываются <span class="math inline">\(d\)</span>)/</p>
<p>Далее мы можем вычислить p-значение для абсолютного значения статистики критерия (<span class="math inline">\(|t|\)</span>) на основе сведений о количестве степеней свободы (<span class="math inline">\(df\)</span>): <span class="math inline">\(df=n−1\)</span> (приблизительно с помощью таблиц критических значений или точно на основе специальной программы).</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon> <strong>Пример</strong>: Одной из извечных российских проблем являются дороги. Для повышения безопасности и комфорта дорожного движения созден специальный национальный проект - «Безопасные качественные дороги», постоянно проводятся профилактические мероприятия, направленные на повышение уровня информированности граждан о правилах дорожного движения, ответственности и сознательности, как водителей, так и пешеходов. Допустим, мы хотели бы выяснить, как меняется ситуация на дорогах, происходит ли снижение количества погибших в ДТП за последние пять лет.</p>
</blockquote>
<p><a href="https://github.com/domelia/rcourse/blob/main/dtp.xls">Скачать данные</a></p>
<p>Загрузим данные Росстата о количестве погибших в ДТП на 100 тыс. населения:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>dtp<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="st">"dtp.xls"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вычислим различия между двумя рядами значений и сделаем проверку на нормальность - графически и с помощью теста Шапиро-Уилка.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dtp)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"region"</span>, <span class="st">"dtp2018"</span>, <span class="st">"dtp2023"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>dtp<span class="sc">$</span>d<span class="ot">&lt;-</span>dtp<span class="sc">$</span>dtp2018<span class="sc">-</span>dtp<span class="sc">$</span>dtp2023</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Сделаем гистограмму</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dtp<span class="sc">$</span>d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(dtp<span class="sc">$</span>d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  dtp$d
W = 0.87308, p-value = 4.961e-07</code></pre>
</div>
</div>
<p>Да, пока результаты не радуют, мы видим, что есть существенные отклонения от нормальности. Если посмотреть на данные, то можно увидеть, что ситуацию осложняет Республика Калмыкия, где произошло большое увеличение количества ДТП. Попробуем убрать этот регион и посмотреть, что получится.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>dtp2<span class="ot">&lt;-</span>dtp <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region<span class="sc">!=</span><span class="st">"Республика Калмыкия"</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dtp2<span class="sc">$</span>d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(dtp2<span class="sc">$</span>d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  dtp2$d
W = 0.989, p-value = 0.6942</code></pre>
</div>
</div>
<p>Совсем другое дело!</p>
<p>Существует два способа подсчета t-критерий для зависимых выборок в зависимости от того, как организованы данные. В нашей таблице данные не совсем «чистые», один и тот же показатель указан в двух столбцах, однако такая ситуация встречается довольно часто.</p>
<section id="метод-1.-разные-столбцы-для-разных-изменений" class="level4">
<h4 class="anchored" data-anchor-id="метод-1.-разные-столбцы-для-разных-изменений">Метод 1. Разные столбцы для разных изменений</h4>
<p>Функция останется прежней, но к ней добавится аргумент <code>paired = TRUE</code>, который и позволит провести измерения с зависимыми выборками:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">t.test</span>(dtp2<span class="sc">$</span>dtp2018, dtp2<span class="sc">$</span>dtp2023, <span class="at">paired =</span> <span class="cn">TRUE</span>) </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  dtp2$dtp2018 and dtp2$dtp2023
t = 8.6723, df = 84, p-value = 2.711e-13
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 1.938852 3.092597
sample estimates:
mean difference 
       2.515725 </code></pre>
</div>
</div>
<p>Поскольку мы сравниваем 2018 год и 2023, то положительная средняя разница означает, что в среднем количество погибших в ДТП сокращается. Статистика t-критерия (8,67) при количестве степеней свободы 84 указывает на достоверные различия (p&lt;0,001).</p>
</section>
<section id="метод-2.-один-столбец-для-всех-изменений-группирующая-переменная" class="level4">
<h4 class="anchored" data-anchor-id="метод-2.-один-столбец-для-всех-изменений-группирующая-переменная">Метод 2. Один столбец для всех изменений + группирующая переменная</h4>
<p>Для того, чтобы воспроизвести эту ситуацию, переструктурируем наши данные таким образом, чтобы вся информация о ДТП была в одном столбце, а период, в который собирались статистические данные, - в другом.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dtp3<span class="ot">&lt;-</span>dtp2 <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span>dtp2018<span class="sc">:</span>dtp2023, </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="at">names_to=</span><span class="st">"year"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="at">values_to =</span> <span class="st">"dtp_number"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Посчитаем t-критерий вторым способом, через формулу:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">t.test</span>(dtp_number <span class="sc">~</span> year, <span class="at">data =</span> dtp3, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  dtp_number by year
t = 8.6723, df = 84, p-value = 2.711e-13
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 1.938852 3.092597
sample estimates:
mean difference 
       2.515725 </code></pre>
</div>
</div>
<p>Как и следовало ожидать, результат идентичный.</p>
<p>Давайте визуализируем это:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggpubr"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggboxplot</span>(dtp3, <span class="at">x =</span> <span class="st">"year"</span>, <span class="at">y =</span> <span class="st">"dtp_number"</span>, </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"year"</span>, <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"dtp2018"</span>, <span class="st">"dtp2023"</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">"Количество погибших в ДТП на 100 тыс. населения"</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggwithinstats</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dtp3,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> year,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> dtp_number</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="критерий-уилкоксона-для-зависимых-выборок" class="level3">
<h3 class="anchored" data-anchor-id="критерий-уилкоксона-для-зависимых-выборок">Критерий Уилкоксона для зависимых выборок</h3>
<p>Если все же проблемы с распределением непреодолимы или данные не являются непрерывными, лучше воспользоваться непараметрическим аналогом для зависимых выборок - критерием знаковых рангов Уилкоксона.</p>
<p>Выше мы уже разбирали формулу данного критерия, здесь же подчеркнем, что мы будем сравнивать два распределения, соответствующие одной и той же группе респондентов (объектов, наблюдений).</p>
<div id="fig-Wpaired" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Wpaired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/StatInf/WPaired.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-Wpaired-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20
</figcaption>
</figure>
</div>
<p>Применим тест Уилкоксона для анализа данных о погибших в ДТП. Попробуем воспроизвести все действия вручную:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dtp2<span class="sc">$</span>rank<span class="ot">&lt;-</span><span class="fu">rank</span>(<span class="fu">abs</span>(dtp2<span class="sc">$</span>d),  <span class="at">ties.method =</span> <span class="st">"average"</span>)<span class="co"># посчитаем ранги</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dtp2<span class="sc">$</span>sign<span class="ot">&lt;-</span><span class="fu">sign</span>(dtp2<span class="sc">$</span>d)<span class="co">#найдем знак различий</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>dtp2<span class="sc">$</span>signed_ranks<span class="ot">&lt;-</span>dtp2<span class="sc">$</span>rank<span class="sc">*</span>dtp2<span class="sc">$</span>sign<span class="co">#умножим ранги на знак</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Посчитаем сумму положительных рангов:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dtp2 <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(signed_ranks<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_ranks=</span><span class="fu">sum</span>(signed_ranks))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  sum_ranks
      &lt;dbl&gt;
1      3321</code></pre>
</div>
</div>
<p>В R мы можем использовать знакомую уже нам функцию <code>wilcox.test()</code>, но указываем аргумент <code>paired=TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(dtp2<span class="sc">$</span>dtp2018, dtp2<span class="sc">$</span>dtp2023, <span class="at">paired =</span> <span class="cn">TRUE</span>, <span class="at">alternative =</span> <span class="st">"two.sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  dtp2$dtp2018 and dtp2$dtp2023
V = 3321, p-value = 6.071e-11
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>Визуализируем это:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggwithinstats</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dtp3,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> year,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> dtp_number,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"non-parametric"</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="anova-с-повторными-измерениями" class="level3">
<h3 class="anchored" data-anchor-id="anova-с-повторными-измерениями">ANOVA с повторными измерениями</h3>
<p>Дисперсионный анализ с повторными измерениями расширяет идею t-критерия для зависимых выборок на случай, когда количество сравниваемых групп превышает две.</p>
<p>Вычисления сходны с теми, что мы рассматривали на примере «обычной» однофакторной ANOVA.</p>
<p>Различия будут заключаться в том, как мы будем подсчитывать среднюю межгрупповую сумму квадратов отклонений, для повторных измерений у в качестве группирующей переменной будет использоваться фактор времени:</p>
<p><span class="math display">\[F=\frac{MS_{time}}{MS_{error}}\]</span></p>
<p>или фактор условия: <span class="math display">\[F=\frac{MS_{condition}}{MS_{error}}\]</span></p>
<p>Например, мы хотим сравнить значения, соответствующие различным временным отрезкам.</p>
<p>Тогда разница группового (внутри отдельных временных диапазонов) и общего среднего составит:</p>
<p><span class="math display">\[S_{time}=SS_b=\sum_{i=1}^{k}(\bar{x_i}-\bar{x})^2\]</span> Разница индивидуальных значений и групповых средних:</p>
<p><span class="math display">\[SSw=\sum_{1}(x_{i1}-\bar{x_1})^2+\sum_{2}(x_{i2}-\bar{x_2})^2+ ... + \sum_{k}(x_{ik}-\bar{x_k})^2\]</span> Разница средних по всем измерениям и общего среднего, k – количество уровней:</p>
<p><span class="math display">\[SS_{subjects}=k*\sum(\bar{x_i}-\bar{x})^2\]</span></p>
<p>Сумма квадратов ошибки:</p>
<p><span class="math display">\[SS_{error}=SS_w-SS_{subjects}\]</span></p>
<p>Тогда средний квадрат отклонений по времени будет:</p>
<p><span class="math display">\[MS_{time}=\frac{SS_{time}}{k-1}\]</span> Соответственно, будет определяться и средняя ошибка:</p>
<p><span class="math display">\[MS_{error}=\frac{SS_{error}}{(n-1)(k-1)}\]</span></p>
<p>Рассмотрим возможности применения данного метода на следующем примере:</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon><strong>Пример</strong>: В исследовании изучалось влияние на восприятие алкогольных напитков различной информации. Сравнивались три напитка – вода, вино и пиво. Участники эксперимента смотрели положительные, нейтральные и негативные информационные материалы, а затем оценивали свое отношение к напитку по шкале от -100 до 100. <a href="https://github.com/domelia/rcourse/blob/main/Alcohol_Attitudes.csv">Скачать данные</a></p>
</blockquote>
<div id="fig-beers" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-beers-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<img src="images/StatInf/beer2.png" id="fig-beer1" class="img-fluid figure-img">
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-beers-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: Примерно так могли выглядеть информационные материалы эксперимента
</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>alcohol_attitudes<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"Alcohol_Attitudes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Наши данные представлены в «широком» формате, переведем их в длинный, оставив только переменные, касающиеся пива:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>alc_long<span class="ot">&lt;-</span>alcohol_attitudes <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(participant, <span class="fu">contains</span>(<span class="st">"beer"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">contains</span>(<span class="st">"beer"</span>), <span class="at">names_to =</span> <span class="st">"emotion"</span>, <span class="at">values_to =</span> <span class="st">"score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Посмотрим описательные статистики по группам:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>alc_long <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(emotion) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_summary_stats</span>(score, <span class="at">type =</span> <span class="st">"mean_sd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  emotion  variable     n  mean    sd
  &lt;chr&gt;    &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 beerneg  score       20  4.45  17.3
2 beerneut score       20 10     10.3
3 beerpos  score       20 21.0   13.0</code></pre>
</div>
</div>
<p>Видим, что оценки разные и следуют логике увеличения по мере смены эмоции с негативной на позитивную.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Сделаем переменную эмоций факторной</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>alc_long<span class="sc">$</span>emotion<span class="ot">&lt;-</span><span class="fu">factor</span>(alc_long<span class="sc">$</span>emotion, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"beerneg"</span>, <span class="st">"beerneut"</span>, <span class="st">"beerpos"</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Сделаем график</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>bxp <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(alc_long, <span class="at">x =</span> <span class="st">"emotion"</span>, <span class="at">y =</span> <span class="st">"score"</span>, <span class="at">fill=</span><span class="st">"emotion"</span>, <span class="at">add =</span> <span class="st">"point"</span>,  )</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>bxp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Сделаем проверку на нормальность:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>alc_long <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(emotion) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shapiro_test</span>(score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  emotion  variable statistic      p
  &lt;fct&gt;    &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
1 beerneg  score        0.896 0.0354
2 beerneut score        0.961 0.573 
3 beerpos  score        0.951 0.375 </code></pre>
</div>
</div>
<p>Видим, что в группе с негативной эмоцией есть отклонения от нормальности, но мы пока закроем на это глаза.</p>
<p>Сопроводим графической проверкой:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggqqplot</span>(alc_long, <span class="st">"score"</span>, <span class="at">facet.by =</span> <span class="st">"emotion"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>res.aov <span class="ot">&lt;-</span> <span class="fu">anova_test</span>(<span class="at">data =</span> alc_long, <span class="at">dv =</span> score, <span class="at">wid=</span>participant, <span class="at">within =</span> emotion)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_anova_table</span>(res.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ANOVA Table (type III tests)

   Effect DFn DFd      F        p p&lt;.05   ges
1 emotion   2  38 17.574 3.95e-06     * 0.207</code></pre>
</div>
</div>
<p>Результаты показывают, что оценки отношения к напитку были статистически различными в разных условиях эксперимента, F(2, 38) = 17.57 p &lt; 0.001, однако обобщенная величина эффекта не очень велика eta2[g] = 0.21.</p>
<p>Проведем парные сравнения:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>pwc <span class="ot">&lt;-</span> alc_long <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_t_test</span>(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    score <span class="sc">~</span> emotion, <span class="at">paired =</span> <span class="cn">TRUE</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.adjust.method =</span> <span class="st">"bonferroni"</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>pwc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 10
  .y.   group1   group2    n1    n2 statistic    df       p   p.adj p.adj.signif
* &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       
1 score beerneg  beern…    20    20     -2.13    19 4.6 e-2 1.39e-1 ns          
2 score beerneg  beerp…    20    20     -5.12    19 6.02e-5 1.81e-4 ***         
3 score beerneut beerp…    20    20     -4.14    19 5.51e-4 2   e-3 **          </code></pre>
</div>
</div>
<p>Различия значимы между оценками, полученными в результате предъявления позитивных материалов, и двумя другими группами (нейтральной и негативной), тогда как различия между негативными и нейтральными материалами не значимы.</p>
<p>Добавим результаты статистического анализа в исходный график:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pwc <span class="ot">&lt;-</span> pwc <span class="sc">%&gt;%</span> <span class="fu">add_xy_position</span>(<span class="at">x =</span> <span class="st">"emotion"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>bxp <span class="sc">+</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pvalue_manual</span>(pwc) <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">get_test_label</span>(res.aov, <span class="at">detailed =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">get_pwc_label</span>(pwc)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ну, или вот так:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggwithinstats</span>(</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> alc_long,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> emotion,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> score</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="критерий-фридмана---непараметрический-аналог-дисперсионного-анализа-для-зависимых-выборок" class="level3">
<h3 class="anchored" data-anchor-id="критерий-фридмана---непараметрический-аналог-дисперсионного-анализа-для-зависимых-выборок">Критерий Фридмана - непараметрический аналог дисперсионного анализа для зависимых выборок</h3>
<p>Тест Фридмана – разработан Милтоном Фридманом, американским экономистом и нобелевским лауреатом.</p>
<div id="fig-friedman" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-friedman-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.nobelprize.org/images/friedman-13280-content-portrait-mobile-tiny.jpg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-friedman-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Милтон Фридман - нобелевский лауреат за исследования в области потребления, монетаризма и политики стабилизации
</figcaption>
</figure>
</div>
<p>Является аналогом ANOVA с повторными измерениями и непараметрического дисперсионного анализа для связанных выборок.</p>
<p>Алгоритм рассета следующий:</p>
<ul>
<li>представить данные в виде матрицы $ {x_{ij} }_{n*k}с $<span class="math inline">\(n\)</span> количеством строк и <span class="math inline">\(k\)</span> количеством столбцов</li>
<li>заменить исходные значения на ранги (<span class="math inline">\(r\)</span>) по каждой строке.</li>
<li>посчитать сумму рангов (<span class="math inline">\(R\)</span>) по каждому столбцу</li>
<li>подставить значения в формулу:</li>
</ul>
<p><span class="math display">\[Q=\frac{12}{N*k*(k+1)}*\sum R^2+(3*N*(k+1))\]</span></p>
<ul>
<li>В тех случаях, когде <span class="math inline">\(n\)</span> или <span class="math inline">\(k\)</span> достаточно большие (например, <span class="math inline">\(n&gt;15\)</span> или <span class="math inline">\(k&gt;4\)</span> статистика критерия может быть аппроксимирована распределением <span class="math inline">\(\chi^2\)</span>. Если <span class="math inline">\(n\)</span> или <span class="math inline">\(k\)</span> маленькие, статистика <span class="math inline">\(\chi^2\)</span> может быть некорректной и лучше воспользоваться специальными таблицами.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>res.fried <span class="ot">&lt;-</span> alc_long <span class="sc">%&gt;%</span> <span class="fu">friedman_test</span>(score <span class="sc">~</span> emotion <span class="sc">|</span>participant)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>res.fried</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .y.       n statistic    df        p method       
* &lt;chr&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        
1 score    20      15.1     2 0.000521 Friedman test</code></pre>
</div>
</div>
<p>Для определения величины эффекта можно воспользоваться критерием W Кендалла:</p>
<p><span class="math display">\[W=\frac{Q}{N(k-1)},\]</span></p>
<p>где <span class="math inline">\(Q\)</span> - статистика теста по Фридману, <span class="math inline">\(N\)</span> объем выборки, <span class="math inline">\(k\)</span> количество измерений по каждому субъекту (M. T. Tomczak and Tomczak 2014).</p>
<p>Значение коэффициента <span class="math inline">\(W\)</span> может принимать значения от 0 (отсутствие взаимосвязи между оценками и уровням измерений) до 1 (тесная взаимосвязь).</p>
<p>Интерпретация коэффициента аналогична <span class="math inline">\(d\)</span> Коэна:</p>
<ul>
<li>0.1 - &lt; 0.3 (маленький эффект)</li>
<li>0.3 - &lt; 0.5 (средний эффект)</li>
<li><blockquote class="blockquote">
<p>= 0.5 (большой эффект).</p>
</blockquote></li>
</ul>
<p>Доверительные интервалы рассчитываются с помощью бутстрэпа (многократного расщепления выборки на наборы данных).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>alc_long <span class="sc">%&gt;%</span> <span class="fu">friedman_effsize</span>(score <span class="sc">~</span> emotion <span class="sc">|</span>participant)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  .y.       n effsize method    magnitude
* &lt;chr&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;ord&gt;    
1 score    20   0.378 Kendall W moderate </code></pre>
</div>
</div>
<p>В данном случае наблюдается средний эффект.</p>
<p>Проведем парные сравнения с помощью теста Уилкоксона:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>pwc <span class="ot">&lt;-</span> alc_long <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wilcox_test</span>(score <span class="sc">~</span> emotion, <span class="at">paired =</span> <span class="cn">TRUE</span>, <span class="at">p.adjust.method =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>pwc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  .y.   group1   group2      n1    n2 statistic        p p.adj p.adj.signif
* &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
1 score beerneg  beerneut    20    20      37   0.036    0.109 ns          
2 score beerneg  beerpos     20    20       6   0.000579 0.002 **          
3 score beerneut beerpos     20    20       7.5 0.00046  0.001 **          </code></pre>
</div>
</div>
<p>Результаты аналогичны тем, что были найдены в ходе применения параметрических процедур.</p>
<p>Визуализируем это:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>pwc <span class="ot">&lt;-</span> pwc <span class="sc">%&gt;%</span> <span class="fu">add_xy_position</span>(<span class="at">x =</span> <span class="st">"emotion"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggboxplot</span>(alc_long, <span class="at">x =</span> <span class="st">"emotion"</span>, <span class="at">y =</span> <span class="st">"score"</span>, <span class="at">fill=</span><span class="st">"emotion"</span>, <span class="at">add =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pvalue_manual</span>(pwc) <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">get_test_label</span>(res.fried,  <span class="at">detailed =</span> <span class="cn">TRUE</span>),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">get_pwc_label</span>(pwc)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Второй вариант визуализации:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggwithinstats</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> alc_long,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> emotion,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> score,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type=</span><span class="st">"non-parametric"</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="анализ-качественных-данных" class="level2">
<h2 class="anchored" data-anchor-id="анализ-качественных-данных">Анализ качественных данных</h2>
<p>Рассмотрев случаи, когда зависимая переменная являлась количественной, перейдем к большому классу исследовательских ситуаций, когда мы исследуем взаимосвязи между категориальными показателями.</p>
<p>К слову, это огромное количество случаев, встречающихся в ходе анализа социологических данных.</p>
<section id="сравниваем-независимые-группы" class="level3">
<h3 class="anchored" data-anchor-id="сравниваем-независимые-группы">Сравниваем независимые группы</h3>
<section id="одновыборочный-z-критерий-сравниваем-значение-одной-доли-с-теоретическим" class="level4">
<h4 class="anchored" data-anchor-id="одновыборочный-z-критерий-сравниваем-значение-одной-доли-с-теоретическим">Одновыборочный z-критерий: сравниваем значение одной доли с теоретическим</h4>
<p>Проводя социологическое исследование, мы можем быть заинтересованы в том, чтобы сравнить результаты, полученные на нашей выборочной с какими-либо предполагаемыми результатами, выраженными в виде пропорции.</p>
<blockquote class="blockquote">
<p><iconify-icon inline="" icon="arcticons:anz" style="font-size: 42px;"></iconify-icon><strong>Пример</strong>: Мы исследуем оценки жителей одного из городских кварталов относительно того, согласны ли они, чтобы рядом с их домами оборудовали большой парк, с велодорожками и прочими благами цивилизации. В этот же момент времени предполагается благоустройство и других объектов, поэтому городские власти бы выбрать именно этот объект для инвестиций, но только в том случае, если оценки населения будут благоприятны и составят не менее 70%. Проведя опрос среди 500 жителей мы обнаружили, что 370 из них выразили согласие с обустройством парка, тогда как 270 человек по каким-то причинам были против парка. Превышает ли количество жителей допустимый предел?</p>
</blockquote>
<p>Помочь в решении нашей задачи может z-критерий для одной пропорции.</p>
<p>Как и в других случаях мы сформулируем гипотезы:</p>
<p>Нулевая гипотеза:</p>
<ul>
<li><span class="math inline">\(H_0:p_o=p_e\)</span></li>
</ul>
<p>Альтернативные гипотезы:</p>
<ul>
<li><span class="math inline">\(H_1:p_o\neq p_e\)</span></li>
<li><span class="math inline">\(H_1:p_o&gt;p_e\)</span></li>
<li><span class="math inline">\(H_1:p_o&lt;p_e\)</span></li>
</ul>
<p>Статистика критерия:</p>
<p><span class="math display">\[z = \frac{p_o-p_e}{\sqrt{p_oq/n}},\]</span></p>
<p>где:</p>
<ul>
<li><span class="math inline">\(p_o\)</span> наблюдаемая доля</li>
<li><span class="math inline">\(q=1−p_o\)</span></li>
<li><span class="math inline">\(p_e\)</span> ожидаемая доля</li>
<li><span class="math inline">\(n\)</span> объем выборки.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x =</span> <span class="dv">370</span>, <span class="at">n =</span> <span class="dv">500</span>, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">alternative =</span> <span class="st">"two.sided"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>res </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1-sample proportions test with continuity correction

data:  370 out of 500, null probability 0.7
X-squared = 3.6214, df = 1, p-value = 0.05704
alternative hypothesis: true p is not equal to 0.7
95 percent confidence interval:
 0.6987864 0.7774592
sample estimates:
   p 
0.74 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="сравнение-двух-долей-пропорций---z-критерий" class="level4">
<h4 class="anchored" data-anchor-id="сравнение-двух-долей-пропорций---z-критерий">Сравнение двух долей (пропорций) - z-критерий</h4>
<p>Мы можем распространить наши рассуждения на тот случай, когда нам требуется сравнить две пропорции, в каких-то группах.</p>
<p>В этом случае критерий несколько преображается:</p>
<p><span class="math display">\[z = \frac{p_1-p_2}{\sqrt{pq/n_1+pq/n_2}},\]</span> где:</p>
<ul>
<li><span class="math inline">\(p_1\)</span> доля, наблюдаемая в группе 1, имеющей размер <span class="math inline">\(n_1\)</span></li>
<li><span class="math inline">\(p_2\)</span> доля, наблюдаемая в группе 2, имеющей размер <span class="math inline">\(n_2\)</span></li>
<li><span class="math inline">\(p\)</span> и <span class="math inline">\(q\)</span> - общие пропорции по всей выборке</li>
<li><span class="math inline">\(q=1−p\)</span></li>
</ul>
<p>Допустим, мы анализируем результаты исследования по климату, и нам хотелось бы знать, как относятся к климатическим изменениям мужчины и женщины. Если точнее, считают ли мужчины более опасным проживание вблизи тающих ледников, чем женщины (или наоборот)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>V1<span class="ot">&lt;-</span>sjlabelled<span class="sc">::</span><span class="fu">as_label</span>(df<span class="sc">$</span>V1)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(df<span class="sc">$</span>V19, df<span class="sc">$</span>V1), <span class="at">margin =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
      Мужской   Женский
  1 0.4178571 0.6135182
  2 0.5821429 0.3864818</code></pre>
</div>
</div>
<p>На первый взгляд кажется, что женщины, действительно, воспринимают риски тающих ледников как более серьезные. Но как это доказать?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infer)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>V19<span class="ot">&lt;-</span>sjlabelled<span class="sc">::</span><span class="fu">as_label</span>(df<span class="sc">$</span>V19)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>V19)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Да, представляет Нет, не представляет 
                 476                  396 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>pr_test<span class="ot">&lt;-</span><span class="fu">prop_test</span>(df, V19 <span class="sc">~</span> V1, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"Мужской"</span>, <span class="st">"Женский"</span>))</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>pr_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  statistic chisq_df     p_value alternative lower_ci upper_ci
      &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;
1      28.4        1 0.000000100 two.sided     -0.268   -0.123</code></pre>
</div>
</div>
</section>
<section id="наш-любимый-хи-квадрат" class="level4">
<h4 class="anchored" data-anchor-id="наш-любимый-хи-квадрат">Наш любимый хи-квадрат</h4>
<p>Критерий <span class="math inline">\(\chi^2\)</span> Пирсона – один из самых известных тестов для анализа категориальных данных. Основан на сравнении наблюдаемых и ожидаемых частот.</p>
<p><span class="math display">\[\chi^2=\sum\frac{(O-E)^2}{E},\]</span></p>
<p>Где: - <span class="math inline">\(O\)</span> - наблюдаемые значения - <span class="math inline">\(E\)</span> - ожидаемые значения (которые были бы в том случае, если бы никакой взаимосвязи между частотами не было)</p>
<p>Гипотезы:</p>
<ul>
<li><span class="math inline">\(H_0\)</span> – между зависимой и независимой переменной нет взаимосвязи – наблюдаемые частоты не отклоняются от ожидаемых частот.</li>
<li><span class="math inline">\(H_1\)</span>- между зависимой и зависимой переменной есть взаимосвязь, наблюдаемые частоты значимо отклоняются от ожидаемых.</li>
</ul>
<p><strong>Условия применения статистического критерия хи-квадрата Пирсона</strong></p>
<ul>
<li>Тип данных: параметры должны быть качественными целочисленными частотами, измеренными в номинальной шкале:
<ul>
<li>бинарными (пол: мужской/женский) или с большим количеством градаций (регион, группа - обучения, специальность)</li>
<li>порядковыми (степень артериальной гипертензии)</li>
</ul></li>
<li>Количество наблюдений более 20
<ul>
<li>Ожидаемая частота, соответствующая нулевой гипотезе должна быть более 5, если ожидаемое явление принимает значение менее 5, то необходимо использовать точный Критерий Фишера.</li>
<li>Для четырехпольных таблиц (2х2): Если ожидаемое значение принимает значение менее 10 (а именно 5&lt;x&lt;10), необходим расчет поправки Йетса.</li>
</ul></li>
<li>Сравниваемые группы должны быть примерно одного размера.</li>
<li>Сопоставляемые группы должны быть независимыми (то есть единицы наблюдения не зависят друг от друга). Для парных сравнений (типа «до-после» существует отдельный тест МакНемара (McNemar).</li>
</ul>
<div class="{callout-important}">
<p>Запрещается: использовать хи-квадрат для анализа непрерывных абсолютных данных, процентов и долей без предварительной перекодировки!</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(df<span class="sc">$</span>V1, df<span class="sc">$</span>V19)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  df$V1 and df$V19
X-squared = 28.37, df = 1, p-value = 1.002e-07</code></pre>
</div>
</div>
<p>Одной из наиболее удачных идей визуализации таблиц сопряженности являются мозаичные диаграммы:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>( <span class="sc">~</span> V19 <span class="sc">+</span> V1, <span class="at">data =</span> df, <span class="at">gp =</span> shading_Friendly, <span class="at">ylab=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Еще примеры:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HairEyeColor"</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mplot</span>(</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assoc</span>(HairEyeColor[,,<span class="at">Sex=</span><span class="st">"Female"</span>], <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">6</span>), <span class="at">shade=</span>T, <span class="at">return_grob=</span>T, <span class="at">main=</span><span class="st">"Female"</span>),</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assoc</span>(HairEyeColor[,,<span class="at">Sex=</span><span class="st">"Male"</span>],   <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">6</span>), <span class="at">shade=</span>T, <span class="at">return_grob=</span>T, <span class="at">main=</span><span class="st">"Male"</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-70-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-70-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-70-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Statistical-Inference_files/figure-html/unnamed-chunk-70-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="сравнение-зависимых-выборок" class="level3">
<h3 class="anchored" data-anchor-id="сравнение-зависимых-выборок">Сравнение зависимых выборок</h3>
<section id="тест-макнемара" class="level4">
<h4 class="anchored" data-anchor-id="тест-макнемара">Тест МакНемара</h4>
<p>Тест Макнемара используется для определения наличия статистически значимой разницы в пропорциях для парных номинальных данных, представленных в таблицах 2 × 2.</p>
<p>Назван в честь <strong>Куинна Майкла Макнемара</strong> (1900 –1986), американского психолога и статистика, разработавшего критерий в 1947 году.</p>
<p><img src="images/StatInf/MacNemar.png" class="img-fluid"></p>
<p><strong>Тест МакНемара. Формула и процедура оценки</strong></p>
<p><img src="images/StatInf/mc_table.png" class="img-fluid"> Нулевая гипотеза о маргинальных частотах: маргинальные вероятности для каждого исхода равны: <span class="math inline">\(p_a + p_b = p_a + p_c\)</span> и <span class="math inline">\(p_c + p_d = p_b + p_d\)</span>.</p>
<p>Нулевая гипотеза предполагает, что для достаточно большого количества рассогласованных пар (более 25), распределение статистики имеет распределение хи-квадрат с одной степенью свободы.</p>
<ul>
<li><span class="math inline">\(H_0: p_b=p_c\)</span></li>
<li><span class="math inline">\(H_1: p_b\neq p_c\)</span></li>
</ul>
<p><span class="math display">\[\chi^2=\frac{(b-c)^2}{b+c}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>Performance <span class="ot">&lt;-</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">794</span>, <span class="dv">86</span>, <span class="dv">150</span>, <span class="dv">570</span>),</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"1st Survey"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Approve"</span>, <span class="st">"Disapprove"</span>),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"2nd Survey"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Approve"</span>, <span class="st">"Disapprove"</span>)))</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>Performance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            2nd Survey
1st Survey   Approve Disapprove
  Approve        794        150
  Disapprove      86        570</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcnemar.test</span>(Performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    McNemar's Chi-squared test with continuity correction

data:  Performance
McNemar's chi-squared = 16.818, df = 1, p-value = 4.115e-05</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="самостоятельная-работа-1" class="level2">
<h2 class="anchored" data-anchor-id="самостоятельная-работа-1">Самостоятельная работа</h2>
</section>
<section id="ссылки-на-источники" class="level2">
<h2 class="anchored" data-anchor-id="ссылки-на-источники">Ссылки на источники</h2>
<div id="refs" role="list">

</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>